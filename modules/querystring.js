function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function charCode(e){return e.charCodeAt(0)}var QueryString=exports,util=require("util");QueryString.unescapeBuffer=function(e,t){var n=new Buffer(e.length),r="CHAR",i,s,o;for(var u=0,a=0;u<=e.length;u++){var f=e.charCodeAt(u);switch(r){case"CHAR":switch(f){case charCode("%"):i=0,s=0,r="HEX0";break;case charCode("+"):t&&(f=charCode(" "));default:n[a++]=f}break;case"HEX0":r="HEX1",o=f;if(charCode("0")<=f&&f<=charCode("9"))i=f-charCode("0");else if(charCode("a")<=f&&f<=charCode("f"))i=f-charCode("a")+10;else{if(!(charCode("A")<=f&&f<=charCode("F"))){n[a++]=charCode("%"),n[a++]=f,r="CHAR";break}i=f-charCode("A")+10}break;case"HEX1":r="CHAR";if(charCode("0")<=f&&f<=charCode("9"))s=f-charCode("0");else if(charCode("a")<=f&&f<=charCode("f"))s=f-charCode("a")+10;else{if(!(charCode("A")<=f&&f<=charCode("F"))){n[a++]=charCode("%"),n[a++]=o,n[a++]=f;break}s=f-charCode("A")+10}n[a++]=16*i+s}}return n.slice(0,a-1)},QueryString.unescape=function(e,t){return QueryString.unescapeBuffer(e,t).toString()},QueryString.escape=function(e){return encodeURIComponent(e)};var stringifyPrimitive=function(e){return util.isString(e)?e:util.isBoolean(e)?e?"true":"false":util.isNumber(e)?isFinite(e)?e:"":""};QueryString.stringify=QueryString.encode=function(e,t,n,r){return t=t||"&",n=n||"=",util.isNull(e)&&(e=undefined),util.isObject(e)?Object.keys(e).map(function(r){var i=QueryString.escape(stringifyPrimitive(r))+n;return util.isArray(e[r])?e[r].map(function(e){return i+QueryString.escape(stringifyPrimitive(e))}).join(t):i+QueryString.escape(stringifyPrimitive(e[r]))}).join(t):r?QueryString.escape(stringifyPrimitive(r))+n+QueryString.escape(stringifyPrimitive(e)):""},QueryString.parse=QueryString.decode=function(e,t,n,r){t=t||"&",n=n||"=";var i={};if(!util.isString(e)||e.length===0)return i;var s=/\+/g;e=e.split(t);var o=1e3;r&&util.isNumber(r.maxKeys)&&(o=r.maxKeys);var u=e.length;o>0&&u>o&&(u=o);for(var a=0;a<u;++a){var f=e[a].replace(s,"%20"),l=f.indexOf(n),c,h,p,d;l>=0?(c=f.substr(0,l),h=f.substr(l+1)):(c=f,h="");try{p=decodeURIComponent(c),d=decodeURIComponent(h)}catch(v){p=QueryString.unescape(c,!0),d=QueryString.unescape(h,!0)}hasOwnProperty(i,p)?util.isArray(i[p])?i[p].push(d):i[p]=[i[p],d]:i[p]=d}return i}