<!DOCTYPE html><html lang="en"><head><title>oj</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="oj"><meta name="groc-project-path" content="src/oj.coffee"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/oj.coffee</div></div><div id="document"><div class="segment"></div><div class="segment"><div class="comments"><div class="wrapper"><h1 id="oj">oj</h1>

<p>Unified templating framework for the people. Thirsty people.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="helpers">Helpers</h2>

<p>Loading with either ready or onload</p></div></div><div class="code"><div class="wrapper"><span class="nv">_load = </span><span class="nf">(evt, fn) -&gt;</span>
  <span class="k">if</span> <span class="nx">$</span><span class="o">?</span> <span class="o">and</span> <span class="nx">evt</span> <span class="o">==</span> <span class="s">&#39;ready&#39;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span>
  <span class="k">else</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add onload if it hasn't happened yet</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">!=</span> <span class="s">&quot;complete&quot;</span>
      <span class="nv">prevOnLoad = </span><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span>
      <span class="nb">window</span><span class="p">.</span><span class="nv">onload = </span><span class="o">-&gt;</span>
        <span class="nx">prevOnLoad</span><span class="o">?</span><span class="p">()</span>
        <span class="nx">fn</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Otherwise call the function</p></div></div><div class="code"><div class="wrapper">    <span class="k">else</span>
      <span class="nx">fn</span><span class="p">()</span>
  <span class="k">return</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Generalized delay loading</p></div></div><div class="code"><div class="wrapper"><span class="nv">_loaderQueue =</span>
  <span class="nv">ready: </span><span class="nx">queue</span><span class="o">:</span><span class="p">[],</span> <span class="nx">loaded</span><span class="o">:</span><span class="kc">false</span>
  <span class="nv">load: </span><span class="nx">queue</span><span class="o">:</span><span class="p">[],</span> <span class="nx">loaded</span><span class="o">:</span><span class="kc">false</span>

<span class="nv">_loader = </span><span class="nf">(evt) -&gt;</span>
  <span class="nf">(fn) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Call everything if no arguments</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span> <span class="nx">fn</span>
      <span class="nx">_loaderQueue</span><span class="p">[</span><span class="nx">evt</span><span class="p">].</span><span class="nv">loaded = </span><span class="kc">true</span>
      <span class="k">while</span> <span class="p">(</span><span class="nv">f = </span><span class="nx">_loaderQueue</span><span class="p">[</span><span class="nx">evt</span><span class="p">].</span><span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">())</span>
        <span class="nx">_load</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">f</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Call load if already loaded</p></div></div><div class="code"><div class="wrapper">    <span class="k">else</span> <span class="k">if</span> <span class="nx">_loaderQueue</span><span class="p">[</span><span class="nx">evt</span><span class="p">].</span><span class="nx">loaded</span>
      <span class="nx">_load</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">f</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Queue function for later</p></div></div><div class="code"><div class="wrapper">    <span class="k">else</span>
      <span class="nx">_loaderQueue</span><span class="p">[</span><span class="nx">evt</span><span class="p">].</span><span class="nx">queue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">fn</span>
    <span class="k">return</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="oj-function">oj function</h2>

<p>Start oj by setting up dom and events</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj = module.exports = </span><span class="nf">(page) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Compile</p></div></div><div class="code"><div class="wrapper">  <span class="nv">compiled = </span><span class="nx">oj</span><span class="p">.</span><span class="nx">compile</span> <span class="p">(</span><span class="nx">require</span> <span class="nx">page</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Setup dom</p></div></div><div class="code"><div class="wrapper">  <span class="nv">html = </span><span class="nx">compiled</span><span class="p">.</span><span class="nx">html</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&#39;oj: &lt;html&gt; element was not found&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;&lt;html&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="nv">html = </span><span class="nx">html</span><span class="p">.</span><span class="nx">slice</span> <span class="p">(</span><span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span> <span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">html</span><span class="p">.</span><span class="nx">lastIndexOf</span> <span class="s">&#39;&lt;&#39;</span>
  <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span> <span class="s">&#39;html&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nv">innerHTML = </span><span class="nx">html</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Setup jquery events and awaken oj objects</p></div></div><div class="code"><div class="wrapper">  <span class="nx">compiled</span><span class="p">.</span><span class="nx">js</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Setup jquery ready and onload events</p></div></div><div class="code"><div class="wrapper">  <span class="nx">oj</span><span class="p">.</span><span class="nx">ready</span><span class="p">()</span>
  <span class="nx">oj</span><span class="p">.</span><span class="nx">load</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojready">oj.ready</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nv">oj.ready = </span><span class="nx">_loader</span> <span class="s">&#39;ready&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojload">oj.load</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nv">oj.load = </span><span class="nx">_loader</span> <span class="s">&#39;load&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojid">oj.id</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nv">oj.id = </span><span class="nf">(len, chars) -&gt;</span>
  <span class="s">&#39;oj&#39;</span> <span class="o">+</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">guid</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">chars</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojguid">oj.guid</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nv">_randomInteger = </span><span class="nf">(min, max) -&gt;</span>
  <span class="k">return</span> <span class="kc">null</span> <span class="k">if</span> <span class="nx">min</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">or</span> <span class="nx">max</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">or</span> <span class="nx">min</span> <span class="o">&gt;</span> <span class="nx">max</span>
  <span class="nv">diff = </span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>random int from zero to number minus one</p></div></div><div class="code"><div class="wrapper">  <span class="nv">rnd = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">diff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nx">rnd</span> <span class="o">+</span> <span class="nx">min</span>

<span class="nv">_chars = </span><span class="s">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39;&#39;</span>
<span class="nv">oj.guid = </span><span class="nf">(len = 8, chars = _chars) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Default arguments</p></div></div><div class="code"><div class="wrapper">  <span class="nv">base = </span><span class="nx">chars</span><span class="p">.</span><span class="nx">length</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Calculate how many chars can be determined by each random call</p></div></div><div class="code"><div class="wrapper">  <span class="nv">charsPerRand = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">base</span><span class="p">)</span>
  <span class="nv">randMin = </span><span class="mi">0</span>
  <span class="nv">randMax = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">charsPerRand</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Calculate random chars by calling random the minimum number of times</p></div></div><div class="code"><div class="wrapper">  <span class="nv">output = </span><span class="s">&quot;&quot;</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">len</span><span class="p">]</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Generate random number</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">i</span> <span class="o">%</span> <span class="nx">charsPerRand</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nv">rand = </span><span class="nx">_randomInteger</span> <span class="nx">randMin</span><span class="p">,</span> <span class="nx">randMax</span>
    <span class="nv">charNext = </span><span class="nx">chars</span><span class="p">[</span><span class="nx">rand</span> <span class="o">%</span> <span class="nx">base</span><span class="p">]</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">charNext</span>
    <span class="nv">rand = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rand</span> <span class="o">/</span> <span class="nx">base</span><span class="p">)</span>

  <span class="nx">output</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Register require.extension for .oj files</p></div></div><div class="code"><div class="wrapper"><span class="k">if</span> <span class="nx">require</span><span class="p">.</span><span class="nx">extensions</span>

  <span class="nv">coffee = </span><span class="nx">require</span> <span class="s">&#39;coffee-script&#39;</span>
  <span class="nv">fs = </span><span class="nx">require</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s">&#39;fs&#39;</span><span class="p">)</span> <span class="c1"># Hack to avoid pulling fs to client</span>

  <span class="nv">stripBOM = </span><span class="nf">(c) -&gt;</span>
    <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xFEFF</span>
      <span class="nv">c = </span><span class="nx">c</span><span class="p">.</span><span class="nx">slice</span> <span class="mi">1</span>
    <span class="nx">c</span>

  <span class="nx">require</span><span class="p">.</span><span class="nx">extensions</span><span class="p">[</span><span class="s">&#39;.oj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(module, filepath) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Compile as coffee-script or javascript</p></div></div><div class="code"><div class="wrapper">    <span class="nv">code = </span><span class="nx">stripBOM</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">filepath</span><span class="p">,</span> <span class="s">&#39;utf8&#39;</span>
    <span class="k">try</span>
      <span class="nv">code = </span><span class="nx">coffee</span><span class="p">.</span><span class="nx">compile</span> <span class="nx">code</span><span class="p">,</span> <span class="nv">bare: </span><span class="kc">true</span>
    <span class="k">catch</span> <span class="nx">e</span> <span class="c1"># js file, do nothing</span>
    <span class="nv">code = </span><span class="s">&quot;(function(){with(require(&#39;oj&#39;)){</span><span class="si">#{</span><span class="nx">code</span><span class="si">}</span><span class="s">}}).call(this);&quot;</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">_compile</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">filepath</span>

<span class="nv">root = </span><span class="nx">@</span>

<span class="nv">oj.version = </span><span class="s">&#39;0.0.6&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Export for NodeJS if necessary</p></div></div><div class="code"><div class="wrapper"><span class="k">if</span> <span class="k">typeof</span> <span class="nx">module</span> <span class="o">!=</span> <span class="s">&#39;undefined&#39;</span>
  <span class="nv">exports = module.exports = </span><span class="nx">oj</span>
<span class="k">else</span>
  <span class="nx">root</span><span class="p">[</span><span class="s">&#39;oj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">oj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="utility-helpers">Utility: Helpers</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nv">ArrayP = </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span>
<span class="nv">FuncP = </span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span>
<span class="nv">ObjP = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span>

<span class="nv">slice = </span><span class="nx">ArrayP</span><span class="p">.</span><span class="nx">slice</span>
<span class="nv">unshift = </span><span class="nx">ArrayP</span><span class="p">.</span><span class="nx">unshift</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Methods from <a href="http://underscorejs.org/">underscore.js</a>, because some methods just need to exist.</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj.__ = _ = </span><span class="p">{}</span>
<span class="nv">_.isUndefined = </span><span class="nf">(obj) -&gt;</span> <span class="nx">obj</span> <span class="o">==</span> <span class="kc">undefined</span>
<span class="nv">_.isBoolean = </span><span class="nf">(obj) -&gt;</span> <span class="nx">obj</span> <span class="o">==</span> <span class="kc">true</span> <span class="o">or</span> <span class="nx">obj</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">or</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;[object Boolean]&#39;</span>
<span class="nv">_.isNumber = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">or</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">toExponential</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">))</span>
<span class="nv">_.isString = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="o">or</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">charCodeAt</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">substr</span><span class="p">))</span>
<span class="nv">_.isDate = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getTimezoneOffset</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">setUTCFullYear</span><span class="p">)</span>
<span class="nv">_.isRegExp = </span><span class="nf">(obj) -&gt;</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;[object RegExp]&#39;</span>
<span class="nv">_.isFunction = </span><span class="nf">(obj) -&gt;</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">==</span> <span class="s">&#39;function&#39;</span>
<span class="nv">_.isArray = </span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span> <span class="o">or</span> <span class="nf">(obj) -&gt;</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;[object Array]&#39;</span>
<span class="nv">_.isElement = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="nv">_.isCapitalLetter = </span><span class="nf">(c) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/[A-Z]/</span><span class="p">)</span>
<span class="nv">_.identity = </span><span class="nf">(v) -&gt;</span> <span class="nx">v</span>
<span class="nv">_.property = </span><span class="nf">(obj, options = {}) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.defaults options, configurable: false</p></div></div><div class="code"><div class="wrapper">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">options</span>
<span class="nv">_.has = </span><span class="nf">(obj, key) -&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
<span class="nv">_.keys = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span> <span class="o">||</span> <span class="nf">(obj) -&gt;</span>
  <span class="k">throw</span> <span class="s">&#39;Invalid object&#39;</span> <span class="k">if</span> <span class="nx">obj</span> <span class="o">!=</span> <span class="nb">Object</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
  <span class="nv">keys = </span><span class="p">[];</span>
  <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">obj</span>
    <span class="k">if</span> <span class="nx">_has</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span>
      <span class="nx">keys</span><span class="p">[</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
  <span class="nx">keys</span>
<span class="nv">_.values = </span><span class="nf">(obj) -&gt;</span>
  <span class="k">throw</span> <span class="s">&#39;Invalid object&#39;</span> <span class="k">if</span> <span class="nx">obj</span> <span class="o">!=</span> <span class="nb">Object</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
  <span class="nv">out = </span><span class="p">[]</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">obj</span><span class="p">,</span> <span class="nf">(v) -&gt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">push</span> <span class="nx">v</span>
  <span class="nx">out</span>

<span class="nv">_.flatten = </span><span class="nf">(array, shallow) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span> <span class="nx">array</span><span class="p">,</span> <span class="p">(</span><span class="nf">(memo, value) -&gt;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">value</span>
      <span class="k">return</span> <span class="nx">memo</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="k">if</span> <span class="nx">shallow</span> <span class="k">then</span> <span class="nx">value</span> <span class="k">else</span> <span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
    <span class="nx">memo</span><span class="p">[</span><span class="nx">memo</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="nx">memo</span>
  <span class="p">),</span> <span class="p">[]</span>

<span class="nv">_.reduce = </span><span class="nf">(obj = [], iterator, memo, context) -&gt;</span>
  <span class="nv">initial = </span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span>
  <span class="k">if</span> <span class="nx">ArrayP</span><span class="p">.</span><span class="nx">reduce</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">reduce</span> <span class="o">==</span> <span class="nx">ArrayP</span><span class="p">.</span><span class="nx">reduce</span>
    <span class="k">if</span> <span class="nx">context</span>
      <span class="nv">iterator = </span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">context</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">initial</span> <span class="k">then</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">reduce</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">memo</span> <span class="k">else</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">reduce</span> <span class="nx">iterator</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">obj</span><span class="p">,</span> <span class="nf">(value, index, list) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">initial</span><span class="p">)</span>
      <span class="nv">memo = </span><span class="nx">value</span>
      <span class="nv">initial = </span><span class="kc">true</span>
    <span class="k">else</span>
      <span class="nv">memo = </span><span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">memo</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">list</span>

  <span class="k">if</span> <span class="o">!</span><span class="nx">initial</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span> <span class="s">&#39;Reduce of empty array with no initial value&#39;</span>
  <span class="nx">memo</span>

  <span class="nv">ctor = </span><span class="o">-&gt;</span>
  <span class="nv">_.bind = </span><span class="nf">(func, context) -&gt;</span>
    <span class="k">if</span> <span class="nx">func</span><span class="p">.</span><span class="nx">bind</span> <span class="o">==</span> <span class="nx">FuncP</span><span class="p">.</span><span class="nx">bind</span> <span class="o">and</span> <span class="nx">FuncP</span><span class="p">.</span><span class="nx">bind</span>
      <span class="k">return</span> <span class="nx">FuncP</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span>
    <span class="nv">args = </span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span> <span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="nv">bound = </span><span class="o">-&gt;</span>
      <span class="nx">unless</span> <span class="k">this</span> <span class="k">instanceof</span> <span class="nx">bound</span>
        <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span> <span class="nx">arguments</span><span class="p">)</span>
      <span class="nv">ctor.prototype = </span><span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span>
      <span class="nv">self = </span><span class="k">new</span> <span class="nx">ctor</span>
      <span class="nv">result = </span><span class="nx">func</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">Object</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="o">==</span> <span class="nx">result</span>
        <span class="k">return</span> <span class="nx">result</span>
      <span class="nx">self</span>

<span class="nv">_.sortedIndex = </span><span class="nf">(array, obj, iterator = _.identity) -&gt;</span>
  <span class="nv">low = </span><span class="mi">0</span>
  <span class="nv">high = </span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">while</span> <span class="nx">low</span> <span class="o">&lt;</span> <span class="nx">high</span>
    <span class="nv">mid = </span><span class="p">(</span><span class="nx">low</span> <span class="o">+</span> <span class="nx">high</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="nx">iterator</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">mid</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nx">iterator</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="k">then</span> <span class="nv">low = </span><span class="nx">mid</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="nv">high = </span><span class="nx">mid</span><span class="p">;</span>
  <span class="nx">low</span>

<span class="nv">_.indexOf = </span><span class="nf">(array, item, isSorted) -&gt;</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="nx">unless</span> <span class="nx">array</span><span class="o">?</span>
  <span class="k">if</span> <span class="nx">isSorted</span>
    <span class="nv">i = </span><span class="nx">_</span><span class="p">.</span><span class="nx">sortedIndex</span> <span class="nx">array</span><span class="p">,</span> <span class="nx">item</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">item</span> <span class="k">then</span> <span class="nx">i</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ArrayP</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">&amp;&amp;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">indexOf</span> <span class="o">==</span> <span class="nx">ArrayP</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">item</span>
  <span class="k">for</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">array</span>
    <span class="k">if</span> <span class="nx">v</span> <span class="o">==</span> <span class="nx">item</span>
      <span class="k">return</span> <span class="nx">i</span>
  <span class="o">-</span><span class="mi">1</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="utility-type-detection">Utility: Type Detection</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.isjQuery</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isjQuery = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">jquery</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.isBackbone</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isBackbone = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="kc">on</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isOJ</span> <span class="nx">obj</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.isOJ
Determine if obj is an OJ instance
TODO: Consider if this should be more duck typed on expected methods</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isOJ = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">ojtype</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Determine if object or array is empty</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isEmpty = </span><span class="nf">(obj) -&gt;</span>
  <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">obj</span>
  <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">obj</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">k</span>
      <span class="k">return</span> <span class="kc">false</span>
  <span class="kc">true</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>typeOf: Mimic behavior of built-in typeof operator and integrate jQuery, Backbone, and OJ types</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.typeOf = </span><span class="nf">(any) -&gt;</span>

  <span class="k">return</span> <span class="s">&#39;null&#39;</span> <span class="k">if</span> <span class="nx">any</span> <span class="o">==</span> <span class="kc">null</span>
  <span class="nv">t = </span><span class="k">typeof</span> <span class="nx">any</span>
  <span class="k">if</span> <span class="nx">t</span> <span class="o">==</span> <span class="s">&#39;object&#39;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">any</span>           <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;array&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isRegExp</span> <span class="nx">any</span>     <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;regexp&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isDate</span> <span class="nx">any</span>       <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;date&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isBackbone</span> <span class="nx">any</span>   <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;backbone&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isjQuery</span> <span class="nx">any</span>     <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;jquery&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isOJ</span> <span class="nx">any</span>         <span class="k">then</span> <span class="nv">t = </span><span class="nx">any</span><span class="p">.</span><span class="nx">ojtype</span>
    <span class="k">else</span>                       <span class="nv">t = </span><span class="s">&#39;object&#39;</span>
  <span class="nx">t</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Determine if obj is a vanilla object</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isObject = </span><span class="nf">(obj) -&gt;</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">typeOf</span> <span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;object&#39;</span>

<span class="nv">_.clone = </span><span class="nf">(obj) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>TODO: support cloning OJ instances
TODO: support options, deep: true</p></div></div><div class="code"><div class="wrapper">  <span class="k">return</span> <span class="nx">obj</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">obj</span>
  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">obj</span> <span class="k">then</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">slice</span><span class="p">()</span> <span class="k">else</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>oj.create 'name',
  methods:
  properties:
  events:</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj.type = </span><span class="nf">(name, args) -&gt;</span>
  <span class="k">throw</span> <span class="s">&#39;NYI&#39;</span>

  <span class="nv">constructor = </span><span class="o">-&gt;</span>
    <span class="vi">@_private = </span><span class="p">{}</span>
    <span class="vi">@_properties = </span><span class="nx">args</span><span class="p">.</span><span class="nx">properties</span>
    <span class="vi">@_methods = </span><span class="nx">args</span><span class="p">.</span><span class="nx">methods</span>
    <span class="vi">@_fields = </span><span class="nx">args</span><span class="p">.</span><span class="nx">fields</span>

<span class="nv">oj.enum = </span><span class="nf">(name, args) -&gt;</span>
  <span class="k">throw</span> <span class="s">&#39;NYI&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h1 id="">#</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nv">Type = </span><span class="nx">oj</span><span class="p">.</span><span class="nx">type</span> <span class="s">&#39;Foo&#39;</span><span class="p">,</span>
  <span class="nv">methods:</span>
    <span class="nv">a: </span><span class="o">-&gt;</span>
    <span class="nv">b: </span><span class="o">-&gt;</span>
      <span class="nx">oj</span><span class="p">.</span><span class="k">super</span><span class="p">()</span>
  <span class="nv">properties:</span>
    <span class="nv">a:</span>
      <span class="nv">get:</span>
    <span class="nv">b:</span>
      <span class="nv">get:</span>
      <span class="nv">set:</span>

<span class="nv">type1 = </span><span class="k">new</span> <span class="nx">Type</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span>
<span class="nv">type2 = </span><span class="k">new</span> <span class="nx">Type</span> <span class="p">(</span><span class="nx">backboneModel</span><span class="p">)</span>  <span class="c1"># will call toJSON() to construct</span>

<span class="nx">Type</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">function</span><span class="p">)</span>
<span class="nx">Type</span><span class="p">.</span><span class="nx">addProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span>
<span class="nx">Type</span><span class="p">.</span><span class="nx">addStaticMethod</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">function</span><span class="p">)</span>
<span class="nx">Type</span><span class="p">.</span><span class="nx">addStaticProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span>
<span class="nx">oj</span><span class="p">.</span><span class="nx">type</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="k">extends</span><span class="o">:</span> <span class="nx">TypeBase</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h1 id="">#</h1></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="utility-iteration">Utility: Iteration</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_each(collection, iterator, context)</p>

<pre><code>Iterate over collection or function. If a function
is encountered it is evaluated before iteration

collection    Array or Object to iterate over
iterator      Function to call on each step
context       (Optional) Object to pass as 'this' to iteration method
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">_.breaker = </span><span class="p">{}</span>
<span class="nv">_.each = </span><span class="nf">(col, iterator, context) -&gt;</span>

  <span class="k">return</span> <span class="k">if</span> <span class="nx">col</span> <span class="o">==</span> <span class="kc">null</span>
  <span class="k">if</span> <span class="nx">ArrayP</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">and</span> <span class="nx">col</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">==</span> <span class="nx">ArrayP</span><span class="p">.</span><span class="nx">forEach</span>
    <span class="nx">col</span><span class="p">.</span><span class="nx">forEach</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">context</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">col</span>
    <span class="k">for</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">col</span>
      <span class="k">if</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">col</span><span class="p">)</span> <span class="o">==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span>
  <span class="k">else</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">col</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">k</span>
        <span class="k">if</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">col</span><span class="p">)</span> <span class="o">==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span>
          <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.map(collection, iterator, options = {})</p>

<pre><code>Map over object or array If a function
is encountered it is evaluated before iteration

collection    Array or Object to iterate over
iterator      Function to call on each step
options
  context       (Optional) Object to pass as 'this' to iteration method
  context       (Optional) Boolean indicating  to pass as 'this' to iteration method
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">_.map = </span><span class="nf">(obj, iterator, options = {}) -&gt;</span>

  <span class="nv">context = </span><span class="nx">options</span><span class="p">.</span><span class="nx">context</span>
  <span class="nv">recurse = </span><span class="nx">options</span><span class="p">.</span><span class="nx">recurse</span>
  <span class="nv">evaluate = </span><span class="nx">options</span><span class="p">.</span><span class="nx">evaluate</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Recurse if necessary</p></div></div><div class="code"><div class="wrapper">  <span class="nv">iterator_ = </span><span class="nx">iterator</span>
  <span class="k">if</span> <span class="nx">recurse</span>
    <span class="nx">do</span> <span class="nf">(options) -&gt;</span>
      <span class="nv">iterator_ = </span><span class="nf">(v,k,o) -&gt;</span>
        <span class="nv">options_ = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">options</span><span class="p">),</span> <span class="p">(</span><span class="nv">key: </span><span class="nx">k</span><span class="p">,</span> <span class="nv">object: </span><span class="nx">v</span><span class="p">)</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">options_</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Evaluate functions if necessary</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Functions pass through if evaluate isn't set</p></div></div><div class="code"><div class="wrapper">    <span class="k">return</span> <span class="nx">obj</span> <span class="nx">unless</span> <span class="nx">evaluate</span>

    <span class="k">while</span> <span class="nx">evaluate</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">obj</span>
      <span class="nv">obj = </span><span class="nx">obj</span><span class="p">()</span>

  <span class="nv">out = </span><span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Array case</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">obj</span>
    <span class="nv">out = </span><span class="p">[]</span>
    <span class="k">return</span> <span class="nx">out</span> <span class="nx">unless</span> <span class="nx">obj</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">map</span> <span class="nx">iterator_</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="k">if</span> <span class="nx">ArrayP</span><span class="p">.</span><span class="nx">map</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">map</span> <span class="o">==</span> <span class="nx">ArrayP</span><span class="p">.</span><span class="nx">map</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="p">(</span><span class="nf">(v, ix, list) -&gt;</span>
      <span class="nx">out</span><span class="p">[</span><span class="nx">out</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">iterator_</span><span class="p">.</span><span class="nx">call</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ix</span><span class="p">,</span> <span class="nx">list</span>
    <span class="p">))</span>

    <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">out.length = </span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Object case</p></div></div><div class="code"><div class="wrapper">  <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">obj</span>
    <span class="nv">out = </span><span class="p">{}</span>
    <span class="k">return</span> <span class="nx">out</span> <span class="nx">unless</span> <span class="nx">obj</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Returning undefined will omit the thing</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span><span class="nv">r = </span><span class="nx">iterator_</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">obj</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">undefined</span>
        <span class="nx">out</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Basis of recursive case</p></div></div><div class="code"><div class="wrapper">  <span class="k">else</span>
    <span class="k">return</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span>
  <span class="nx">out</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.extend</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.extend = </span><span class="nf">(obj) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="nf">(source) -&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">source</span>
      <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="p">))</span>
  <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.defaults</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.defaults = </span><span class="nf">(obj) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="nf">(source) -&gt;</span>
    <span class="k">for</span> <span class="nx">prop</span> <span class="k">of</span> <span class="nx">source</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span><span class="o">?</span>
        <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
  <span class="p">))</span>
  <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojpartial-module-arg1-arg2-">oj.partial (module, arg1, arg2, ...)</h2>

<p>Arguments are passed to exported module</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj.partial = </span><span class="nf">(module, json) -&gt;</span>
  <span class="nv">m = </span><span class="nx">require</span> <span class="nx">module</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">m</span><span class="p">)</span> <span class="o">and</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">m</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)...</span>
  <span class="nx">m</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojtag-name-attributes-content-content-">oj.tag (name, attributes, content, content, ...)</h2>

<pre><code>name          String of the tag to serialize
attributes    (Optional) Object defining attributes of tag being serialized
              Keys have smart mappings:
                  'c'  will map to 'class'
                  'fontSize' will map to 'font-size'
                  'borderRadius' will map to 'moz-border-radius', etc.
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">oj._result = </span><span class="kc">null</span>

<span class="nv">oj.tag = </span><span class="nf">(name, args...) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>console.log "calling oj.tag name: #{name}, args: ", args, ", result: ", oj._result</p></div></div><div class="code"><div class="wrapper">  <span class="k">throw</span> <span class="s">&#39;oj.tag error: argument 1 is not a string (expected tag name)&#39;</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">name</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Build ojml starting with tag</p></div></div><div class="code"><div class="wrapper">  <span class="nv">ojml = </span><span class="p">[</span><span class="nx">name</span><span class="p">]</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get attributes from args by unioning all objects</p></div></div><div class="code"><div class="wrapper">  <span class="nv">attributes = </span><span class="p">{}</span>
  <span class="k">for</span> <span class="nx">arg</span> <span class="k">in</span> <span class="nx">args</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>TODO: evaluate argument if necessary</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">arg</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">arg</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Help the attributes out as they have shitting</p></div></div><div class="code"><div class="wrapper">  <span class="nv">attributes = </span><span class="nx">_tagAttributes</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">attributes</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add attributes to ojml if they exist</p></div></div><div class="code"><div class="wrapper">  <span class="nx">ojml</span><span class="p">.</span><span class="nx">push</span> <span class="nx">attributes</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="nx">attributes</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Push result. This is necessary to give the div -> syntax. It makes me sad.</p></div></div><div class="code"><div class="wrapper">  <span class="nv">lastResult = </span><span class="nx">oj</span><span class="p">.</span><span class="nx">_result</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Loop over attributes</p></div></div><div class="code"><div class="wrapper">  <span class="k">for</span> <span class="nx">arg</span> <span class="k">in</span> <span class="nx">args</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">arg</span>
      <span class="k">continue</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">arg</span>
      <span class="nv">oj._result = </span><span class="nx">ojml</span>
      <span class="nv">len = </span><span class="nx">ojml</span><span class="p">.</span><span class="nx">length</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Call the argument it will auto append to _result which is ojml</p></div></div><div class="code"><div class="wrapper">      <span class="nv">r = </span><span class="nx">arg</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>If nothing was changed push the result instead div(-> 1)</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="nx">len</span> <span class="o">==</span> <span class="nx">ojml</span><span class="p">.</span><span class="nx">length</span> <span class="o">and</span> <span class="nx">r</span><span class="o">?</span>
        <span class="nx">ojml</span><span class="p">.</span><span class="nx">push</span> <span class="nx">r</span>

    <span class="k">else</span>
      <span class="nx">ojml</span><span class="p">.</span><span class="nx">push</span> <span class="nx">arg</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Pop result and result self</p></div></div><div class="code"><div class="wrapper">  <span class="nv">oj._result = </span><span class="nx">lastResult</span>
  <span class="k">if</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">_result</span>
    <span class="nx">oj</span><span class="p">.</span><span class="nx">_result</span><span class="p">.</span><span class="nx">push</span> <span class="nx">ojml</span>
  <span class="nx">ojml</span>

<span class="nv">oj.tag.elements =</span>
  <span class="nv">closed: </span><span class="s">&#39;a abbr acronym address applet article aside audio b bdo big blockquote body button canvas caption center cite code colgroup command datalist dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer form frameset h1 h2 h3 h4 h5 h6 head header hgroup html i iframe ins keygen kbd label legend li map mark menu meter nav noframes noscript object ol optgroup option output p pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr tt u ul var video wbr xmp&#39;</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39; &#39;</span>
  <span class="nv">open: </span><span class="s">&#39;area base br col command embed hr img input keygen link meta param source track wbr&#39;</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39; &#39;</span>

<span class="nv">oj.tag.elements.all = </span><span class="p">(</span><span class="nx">oj</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">closed</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">open</span><span class="p">).</span><span class="nx">sort</span><span class="p">()</span>

<span class="nv">oj.tag.isClosed = </span><span class="nf">(tag) -&gt;</span>
  <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">open</span><span class="p">,</span> <span class="nx">tag</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create tag methods</p></div></div><div class="code"><div class="wrapper"><span class="k">for</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">all</span>
  <span class="nx">do</span> <span class="nf">(t) -&gt;</span>
    <span class="nx">oj</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">tag</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">...</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Customize a few tags</p></div></div><div class="code"><div class="wrapper"><span class="nv">_defaultClear = </span><span class="nf">(dest, d, e) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span> <span class="nx">dest</span><span class="p">,</span> <span class="nx">d</span>
  <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">e</span>
    <span class="nx">dest</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="nx">dest</span>

<span class="nv">_tagAttributes = </span><span class="nf">(name, attributes) -&gt;</span>
  <span class="nv">attr = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">attributes</span>
  <span class="k">switch</span> <span class="nx">name</span>
    <span class="k">when</span> <span class="s">&#39;link&#39;</span> <span class="k">then</span> <span class="nx">_defaultClear</span> <span class="nx">attr</span><span class="p">,</span> <span class="p">{</span><span class="nx">rel</span><span class="o">:</span><span class="s">&#39;stylesheet&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s">&#39;text/css&#39;</span><span class="p">,</span> <span class="nv">href: </span><span class="nx">attr</span><span class="p">.</span><span class="nx">url</span> <span class="o">or</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">src</span><span class="p">},</span> <span class="p">{</span><span class="nx">url</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="nx">src</span><span class="o">:</span><span class="mi">0</span><span class="p">}</span>
    <span class="k">when</span> <span class="s">&#39;script&#39;</span> <span class="k">then</span> <span class="nx">_defaultClear</span> <span class="nx">attr</span><span class="p">,</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="s">&#39;text/javascript&#39;</span><span class="p">,</span> <span class="nv">src: </span><span class="nx">attr</span><span class="p">.</span><span class="nx">url</span><span class="p">},</span> <span class="nx">url</span><span class="o">:</span><span class="mi">0</span>
    <span class="k">when</span> <span class="s">&#39;a&#39;</span> <span class="k">then</span> <span class="nx">_defaultClear</span> <span class="nx">attr</span><span class="p">,</span> <span class="p">{</span><span class="nx">href</span><span class="o">:</span><span class="nx">attr</span><span class="p">.</span><span class="nx">url</span><span class="p">},</span> <span class="nx">url</span><span class="o">:</span><span class="mi">0</span>
  <span class="nx">attr</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>oj.styles = ()</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojextend-context">oj.extend (context)</h2>

<pre><code>Extend oj methods into a context. Common contexts are `global` `window`
and `this` (used in coffee script). Helper methods are not extended (oj._)

context          Object to extend oj methods and objects into
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">oj.extend = </span><span class="nf">(context) -&gt;</span>
  <span class="nv">o = </span><span class="p">{}</span>
  <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">oj</span>
    <span class="k">if</span> <span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span>
      <span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
  <span class="k">delete</span> <span class="nx">o</span><span class="p">.</span><span class="nx">extend</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">o</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojcompile">oj.compile</h2>

<p>Return html and js after templating json</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj.compile = </span><span class="nf">(options, ojml) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Options is optional</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">options</span>
    <span class="nv">ojml = </span><span class="nx">options</span>
    <span class="nv">options = </span><span class="p">{}</span>

  <span class="nv">options = </span><span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span> <span class="p">{},</span> <span class="nx">options</span><span class="p">,</span>
    <span class="nv">html: </span><span class="kc">true</span>
    <span class="nv">debug: </span><span class="kc">false</span>

  <span class="nv">options.html = </span><span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">html</span> <span class="k">then</span> <span class="p">[]</span> <span class="k">else</span> <span class="kc">null</span>  <span class="c1"># html accumulator</span>
  <span class="nv">options.js = </span><span class="p">[]</span>                                   <span class="c1"># code accumulator</span>
  <span class="nv">options.types = </span><span class="p">[]</span>                                <span class="c1"># types accumulator</span>
  <span class="nv">options.indent = </span><span class="s">&#39;&#39;</span>                               <span class="c1"># indent counter</span>

  <span class="nx">_compileAny</span> <span class="nx">ojml</span><span class="p">,</span> <span class="nx">options</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Join html only if generated</p></div></div><div class="code"><div class="wrapper">  <span class="nv">html = </span><span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;&#39;</span>
  <span class="nv">out = html: </span><span class="nx">html</span><span class="p">,</span> <span class="nv">types: </span><span class="nx">options</span><span class="p">.</span><span class="nx">types</span><span class="p">,</span> <span class="nx">js</span><span class="o">:-&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Call defered javascript</p></div></div><div class="code"><div class="wrapper">    <span class="k">for</span> <span class="nx">fn</span> <span class="k">in</span> <span class="nx">options</span><span class="p">.</span><span class="nx">js</span>
      <span class="nx">fn</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Call awaken for all objects</p></div></div><div class="code"><div class="wrapper">    <span class="k">for</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">options</span><span class="p">.</span><span class="nx">types</span>
      <span class="nx">t</span><span class="p">.</span><span class="nx">awaken</span><span class="p">()</span>
    <span class="kc">undefined</span>

<span class="nv">_styleKeyFromFancy = </span><span class="nf">(key) -&gt;</span>
  <span class="nv">out = </span><span class="s">&quot;&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Loop over characters in key looking for camal case</p></div></div><div class="code"><div class="wrapper">  <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">key</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isCapitalLetter</span> <span class="nx">c</span>
      <span class="nx">out</span> <span class="o">+=</span> <span class="s">&quot;-</span><span class="si">#{</span><span class="nx">c</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="si">}</span><span class="s">&quot;</span>
    <span class="k">else</span>
      <span class="nx">out</span> <span class="o">+=</span> <span class="nx">c</span>
  <span class="nx">out</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Convert object to string form</p></div></div><div class="code"><div class="wrapper"><span class="nv">_styleFromObject = </span><span class="nf">(obj) -&gt;</span>
  <span class="nv">out = </span><span class="s">&quot;&quot;</span>
  <span class="nv">first = </span><span class="kc">true</span>
  <span class="k">for</span> <span class="nx">kFancy</span> <span class="k">in</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">sort</span><span class="p">()</span>
    <span class="nv">k = </span><span class="nx">_styleKeyFromFancy</span> <span class="nx">kFancy</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">first</span>
      <span class="nx">out</span> <span class="o">+=</span> <span class="s">&#39;;&#39;</span>
    <span class="nx">out</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">k</span><span class="si">}</span><span class="s">:</span><span class="si">#{</span><span class="nx">obj</span><span class="p">[</span><span class="nx">kFancy</span><span class="p">]</span><span class="si">}</span><span class="s">&quot;</span>
    <span class="nv">first = </span><span class="kc">false</span>
  <span class="nx">out</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Recursive helper for compiling that wraps indention</p></div></div><div class="code"><div class="wrapper"><span class="nv">_compileDeeper = </span><span class="nf">(method, ojml, options) -&gt;</span>
  <span class="nv">i = </span><span class="nx">options</span><span class="p">.</span><span class="nx">indent</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">indent</span> <span class="o">+=</span> <span class="s">&#39;\t&#39;</span>
  <span class="nx">method</span> <span class="nx">ojml</span><span class="p">,</span> <span class="nx">options</span>
  <span class="nv">options.indent = </span><span class="nx">i</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Compile ojml or any type</p></div></div><div class="code"><div class="wrapper"><span class="nv">_compileAny = </span><span class="nf">(ojml, options) -&gt;</span>

  <span class="k">switch</span> <span class="nx">_</span><span class="p">.</span><span class="nx">typeOf</span> <span class="nx">ojml</span>

    <span class="k">when</span> <span class="s">&#39;array&#39;</span>
      <span class="nx">_compileTag</span> <span class="nx">ojml</span><span class="p">,</span> <span class="nx">options</span>

    <span class="k">when</span> <span class="s">&#39;oj&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Found an oj object. Compile its result</p></div></div><div class="code"><div class="wrapper">      <span class="nx">_compileAny</span> <span class="nx">ojml</span><span class="p">.</span><span class="nx">oj</span><span class="p">(),</span> <span class="nx">options</span>

    <span class="k">when</span> <span class="s">&#39;jquery&#39;</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="nx">ojml</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">outerHTML</span>

    <span class="k">when</span> <span class="s">&#39;string&#39;</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="nx">ojml</span>

    <span class="k">when</span> <span class="s">&#39;boolean&#39;</span><span class="p">,</span> <span class="s">&#39;number&#39;</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">ojml</span><span class="si">}</span><span class="s">&quot;</span>

    <span class="k">when</span> <span class="s">&#39;function&#39;</span>
      <span class="nx">_compileAny</span> <span class="nx">ojml</span><span class="p">(),</span> <span class="nx">options</span>

    <span class="k">when</span> <span class="s">&#39;null&#39;</span><span class="p">,</span> <span class="s">&#39;undefined&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>do nothing</p></div></div><div class="code"><div class="wrapper">    <span class="k">else</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;oj.compile: #{typeof ojml} cannot be compiled&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Supported events from jquery</p></div></div><div class="code"><div class="wrapper"><span class="nv">events = </span><span class="nx">bind</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="kc">on</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="kc">off</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">live</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">blur</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">change</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">click</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">dblclick</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">focus</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">focusin</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">focusout</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">hover</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">keydown</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">keypress</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">keyup</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">mousedown</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">mouseenter</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">mousemove</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">mouseout</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">mouseup</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ready</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">resize</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">scroll</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">select</span><span class="o">:</span><span class="mi">1</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Compile ojml tag (an array)</p></div></div><div class="code"><div class="wrapper"><span class="nv">_compileTag = </span><span class="nf">(ojml, options) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get tag</p></div></div><div class="code"><div class="wrapper">  <span class="nv">tag = </span><span class="nx">ojml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&#39;oj.compile: tag is missing&#39;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="o">and</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create oj object if tag is capitalized</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isCapitalLetter</span> <span class="nx">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">_compileDeeper</span> <span class="nx">_compileAny</span><span class="p">,</span> <span class="p">(</span><span class="k">new</span> <span class="nx">oj</span><span class="p">[</span><span class="nx">tag</span><span class="p">]</span> <span class="nx">ojml</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nx">options</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get attributes (optional)</p></div></div><div class="code"><div class="wrapper">  <span class="nv">attributes = </span><span class="kc">null</span>
  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">ojml</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nv">attributes = </span><span class="nx">ojml</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

  <span class="nv">children = </span><span class="k">if</span> <span class="nx">attributes</span> <span class="k">then</span> <span class="nx">ojml</span><span class="p">.</span><span class="nx">slice</span> <span class="mi">2</span> <span class="k">else</span> <span class="nx">ojml</span><span class="p">.</span><span class="nx">slice</span> <span class="mi">1</span>

  <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">html</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>attribute.style can be set with objects</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">attributes</span><span class="o">?</span><span class="p">.</span><span class="nx">style</span>
      <span class="nv">attributes.style = </span><span class="nx">_styleFromObject</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">style</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>attribute.c stands for class</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">attributes</span><span class="o">?</span><span class="p">.</span><span class="nx">c</span><span class="o">?</span>
      <span class="nv">attributes.class = </span><span class="nx">attributes</span><span class="p">.</span><span class="nx">c</span>
      <span class="nv">attributes.c = </span><span class="kc">null</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>attributes.class can be set with arrays</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">attributes</span><span class="o">?</span><span class="p">.</span><span class="k">class</span>
      <span class="nv">attributes.class = </span><span class="nx">attributes</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39; &#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>TODO: consider jsoning any object (good for attribute.data)</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Convert attributes to string</p></div></div><div class="code"><div class="wrapper">    <span class="nv">attr = </span><span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="nx">attributes</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Filter out attributes that are events</p></div></div><div class="code"><div class="wrapper">      <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">attributes</span>
        <span class="nx">do</span><span class="nf">(k,v) -&gt;</span>
          <span class="k">if</span> <span class="nx">events</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="o">?</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add attribute id if necessary</p></div></div><div class="code"><div class="wrapper">            <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">?=</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">id</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Bind event if jquery exists</p></div></div><div class="code"><div class="wrapper">            <span class="k">if</span> <span class="nx">$</span><span class="o">?</span>
              <span class="nx">options</span><span class="p">.</span><span class="nx">js</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="o">-&gt;</span>
                <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">v</span>
                  <span class="nx">$el</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">v</span>
                <span class="k">else</span>
                  <span class="nx">$el</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="nx">v</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="nx">attributes</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span>
          <span class="k">return</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Serialize attributes in order for consistent output</p></div></div><div class="code"><div class="wrapper">      <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">attributes</span><span class="p">).</span><span class="nx">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">v = </span><span class="nx">attributes</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span><span class="o">?</span>
          <span class="nx">attr</span> <span class="o">+=</span> <span class="s">&quot; </span><span class="si">#{</span><span class="nx">k</span><span class="si">}</span><span class="s">=\&quot;</span><span class="si">#{</span><span class="nx">v</span><span class="si">}</span><span class="s">\&quot;&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Start tag</p></div></div><div class="code"><div class="wrapper">    <span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;&lt;</span><span class="si">#{</span><span class="nx">tag</span><span class="si">}#{</span><span class="nx">attr</span><span class="si">}</span><span class="s">&gt;&quot;</span>

  <span class="k">if</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">children</span>
      <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">debug</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;\n\t</span><span class="si">#{</span><span class="nx">options</span><span class="p">.</span><span class="nx">indent</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="nx">_compileDeeper</span> <span class="nx">_compileAny</span><span class="p">,</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">options</span>
    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">debug</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;\n</span><span class="si">#{</span><span class="nx">options</span><span class="p">.</span><span class="nx">indent</span><span class="si">}</span><span class="s">&quot;</span>
  <span class="k">else</span>
    <span class="k">for</span> <span class="nx">child</span> <span class="k">in</span> <span class="nx">children</span>
      <span class="nx">_compileDeeper</span> <span class="nx">_compileAny</span><span class="p">,</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">options</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>End tag if you have children or your tag closes</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">oj</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">isClosed</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">html</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;&lt;/</span><span class="si">#{</span><span class="nx">tag</span><span class="si">}</span><span class="s">&gt;&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojcontrol">oj.Control</h2>

<p>Properties
  $             gets root element
  set           Initialize from element, $(selector), or ojml</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Methods
  constructor   Called when object is first constructed
  initialize    Called when object is serialized into dom
  parse         Called when object is being constructed     (need this?)
  ojml          Property to set or get ojml of this object. Will reinitialize if set
  toJSON        Alias for ojml get method</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj.Control = </span><span class="k">class</span> <span class="nx">Control</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojlink">oj.Link</h2>

<p>oj.Link = class Link extends Control</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojdomreplace">oj.domReplace</h2>

<p>Replace element's html with jsml.  Starts OJ objects.</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj.replace = </span><span class="nf">(el, ojml) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Element can be dom or jquery</p></div></div><div class="code"><div class="wrapper">  <span class="nv">el = </span><span class="nx">el</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isjQuery</span> <span class="nx">el</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Template</p></div></div><div class="code"><div class="wrapper">  <span class="nv">template = </span><span class="nx">oj</span><span class="p">.</span><span class="nx">template</span> <span class="nx">ojml</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Replace</p></div></div><div class="code"><div class="wrapper">  <span class="nx">_</span><span class="p">.</span><span class="nx">domReplaceHtml</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">template</span><span class="p">.</span><span class="nx">html</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>initialize</p></div></div><div class="code"><div class="wrapper">  <span class="nx">template</span><span class="p">.</span><span class="nx">js</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="dominsertelementafter">domInsertElementAfter</h2>

<p>DOM utility function to help insert elements after a given element (similar to domInsertBefore)</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.domInsertElementAfter = </span><span class="nf">(elLocation, elToInsert) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;domInsertElementAfter error: elementLocation is null&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">elLocation</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;domInsertElementAfter error: elementToInsert is null&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">elToInsert</span>
  <span class="nv">elNext = </span><span class="nx">elLocation</span><span class="p">.</span><span class="nx">nextSibling</span>
  <span class="nv">elParent = </span><span class="nx">elLocation</span><span class="p">.</span><span class="nx">parentNode</span>
  <span class="k">if</span> <span class="nx">elNext</span>
    <span class="nx">elParent</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="nx">elToInsert</span><span class="p">,</span> <span class="nx">elNext</span>
  <span class="k">else</span>
    <span class="nx">elParent</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">elToInsert</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="domreplacehtml">domReplaceHtml</h2>

<p>Source: http://www.bigdumbdev.com/2007/09/replacehtml-remove-insert-put-back-is.html</p>

<p>Basic idea is that setting html on something not on the dom is faster
TODO: Allow insertion of TR into TBODY.  Must recognize parent tag of destination and make the temporary tag match this.  With TBODY you then need to add TABLE as well.</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.domReplaceHtml = </span><span class="nf">(el, html) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;domReplaceHtml error: element is null&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">el</span>
  <span class="nv">nextSibling = </span><span class="nx">el</span><span class="p">.</span><span class="nx">nextSibling</span>
  <span class="nv">parent = </span><span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span>
  <span class="nx">parent</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">el</span>
  <span class="nv">el.innerHTML = </span><span class="nx">html</span>
  <span class="k">if</span> <span class="nx">nextSibling</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">nextSibling</span>
  <span class="k">else</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">el</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="domappendhtml">domAppendHtml</h2>

<p>Append html after all children of element</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>TODO: Allow insertion of TR into TBODY.</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.domAppendHtml = </span><span class="nf">(el, html) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;oj.domAppendHtml: element is null&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">el</span>
  <span class="nv">elTemp = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span>
  <span class="nv">elTemp.innerHTML = </span><span class="nx">html</span>
  <span class="k">while</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">elTemp = </span><span class="kc">undefined</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="domprependhtml">domPrependHtml</h2>

<p>Prepend html before all children of element
TODO: Allow insertion of TR into TBODY.</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.domPrependHtml = </span><span class="nf">(el, html) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;oj.domPrependHtml: element is null&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">el</span>
  <span class="nv">elTemp = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span>
  <span class="nv">elTemp.innerHTML = </span><span class="nx">html</span>
  <span class="k">while</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nx">el</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">elTemp = </span><span class="kc">undefined</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="dominserthtmlbefore">domInsertHtmlBefore</h2>

<p>Insert html before the given element
TODO: Allow insertion of TR into TBODY.</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.domInsertHtmlBefore = </span><span class="nf">(el, html) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;oj.domInsertHtmlBefore: element is null&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">el</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>special case</p></div></div><div class="code"><div class="wrapper">  <span class="nv">elTemp = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span>
  <span class="nv">elTemp.innerHTML = </span><span class="nx">html</span>
  <span class="nv">parent = </span><span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span>
  <span class="k">while</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nx">el</span>
  <span class="nv">elTemp = </span><span class="kc">undefined</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="dominserthtmlafter">domInsertHtmlAfter</h2>

<p>Insert html after the given element
TODO: Allow insertion of TR into TBODY.</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.domInsertHtmlAfter = </span><span class="nf">(el, html) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;oj.domInsertHtmlAfter: element is null&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">el</span>
  <span class="nv">elTemp = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span>
  <span class="nv">elTemp.innerHTML = </span><span class="nx">html</span>
  <span class="nv">elBefore = </span><span class="nx">el</span>
  <span class="k">while</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span>
    <span class="nv">elBeforeNext = </span><span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">domInsertElementAfter</span> <span class="nx">elBefore</span><span class="p">,</span> <span class="nx">elTemp</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nv">elBefore = </span><span class="nx">elBeforeNext</span>

  <span class="nv">elTemp = </span><span class="kc">undefined</span></div></div></div></div></body></html>