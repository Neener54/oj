<!DOCTYPE html>

<html>
<head>
  <title>oj.litcoffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>oj.litcoffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>oj</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>A unified templating framework for the people. Thirsty people.</p>
<h2>oj function</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Convert ojml to dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj = module.<span class="function"><span class="title">exports</span></span> = -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Prevent oj method from propagating</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.argumentsPush()
  ojml = oj.emit.apply @, arguments
  _.argumentsPop()
  ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Emit arguments as if it was an oj tag function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">emit</span></span> = -&gt;
  ojml = oj.tag <span class="string">'oj'</span>, arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Keep a reference to ourselves for templates to see</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.oj = oj</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2>oj.begin</h2>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">begin</span></span> = (page) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Defer dom manipulation until the page has loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _readyOrLoad -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Compile only the body and below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bodyOnly = html:<span class="number">1</span>, doctype:<span class="number">1</span>, head:<span class="number">1</span>, link:<span class="number">1</span>, script:<span class="number">1</span>
    {dom,types} = oj.compile dom:<span class="number">1</span>, html:<span class="number">0</span>, css:<span class="number">0</span>, ignore:bodyOnly, (require page)

    <span class="keyword">if</span> <span class="keyword">not</span> dom?
      console.error <span class="string">'oj: dom failed to compile'</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Find body</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    body = document.getElementsByTagName(<span class="string">'body'</span>)
    <span class="keyword">if</span> body.length == <span class="number">0</span>
      console.error <span class="string">'oj: &lt;body&gt; was not found'</span>
      <span class="keyword">return</span>
    body = body[<span class="number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Clear body and insert dom elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    body.innerHTML = <span class="string">''</span>
    <span class="keyword">if</span> <span class="keyword">not</span> oj.isArray dom
      dom = [dom]
    <span class="keyword">for</span> d <span class="keyword">in</span> dom
      body.appendChild d

    <span class="keyword">for</span> t <span class="keyword">in</span> types
      t.inserted()</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Trigger events bound through oj.ready</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.ready()</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2>_readyOrLoad</h2>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Helper method that loads with either ready or onload (whichever exists)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_readyOrLoad</span></span> = (fn) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>  Use jquery ready if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> jQuery?
    jQuery fn</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>  Use onload</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Add onload if it hasn&#39;t happened yet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> document.readyState != <span class="string">"complete"</span>
      prevOnLoad = window.onload
      window.<span class="function"><span class="title">onload</span></span> = -&gt;
        prevOnLoad?()
        fn()</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>  Call the function immediately if onload already happened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">else</span>
      fn()
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h2>oj.ready</h2>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>_readyQueue = queue:[], loaded:<span class="literal">false</span>
oj.<span class="function"><span class="title">ready</span></span> = (f) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Call everything if no arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> oj.isUndefined f
    _readyQueue.loaded = <span class="literal">true</span>
    <span class="keyword">while</span> (f = _readyQueue.queue.shift())
      f()</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Call load if already loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span> <span class="keyword">if</span> _readyQueue.loaded
    f()</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Queue function for later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span>
    _readyQueue.queue.push f
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2>oj.id</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Generate a unique oj id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">id</span></span> = (len, chars) -&gt;
  <span class="string">'oj'</span> + oj.guid len, chars</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2>oj.guid</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_randomInteger</span></span> = (min, max) -&gt;
  <span class="keyword">return</span> <span class="literal">null</span> <span class="keyword">if</span> min == <span class="literal">null</span> <span class="keyword">or</span> max == <span class="literal">null</span> <span class="keyword">or</span> min &gt; max
  diff = max - min;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>random int from zero to number minus one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  rnd = Math.floor Math.random() * (diff + <span class="number">1</span>)
  rnd + min

_chars = <span class="string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span>.split <span class="string">''</span>
oj.<span class="function"><span class="title">guid</span></span> = (len = <span class="number">8</span>, chars = _chars) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Default arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  base = chars.length</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Calculate how many chars can be determined by each random call</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  charsPerRand = Math.floor Math.log(Math.pow(<span class="number">2</span>,<span class="number">31</span>)-<span class="number">1</span>) / Math.log(base)
  randMin = <span class="number">0</span>
  randMax = Math.pow(base, charsPerRand)-<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Calculate random chars by calling random the minimum number of times</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  output = <span class="string">""</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..len]</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Generate random number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> i % charsPerRand == <span class="number">0</span>
      rand = _randomInteger randMin, randMax
    charNext = chars[rand % base]
    output += charNext
    rand = Math.floor(rand / base)

  output</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2>Register require.extension for .oj files in node</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>TODO: Consider moving this to server.litcoffee</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">if</span> require.extensions

  coffee = require <span class="string">'coffee-script'</span>

  <span class="function"><span class="title">stripBOM</span></span> = (c) -&gt; <span class="keyword">if</span> c.charCodeAt(<span class="number">0</span>) == <span class="number">0xFEFF</span> <span class="keyword">then</span> (c.slice <span class="number">1</span>) <span class="keyword">else</span> c

  <span class="function"><span class="title">wrapJS</span></span> = (code) -&gt;
    <span class="string">"(function(){with(oj.sandbox){<span class="subst">#{code}</span>}}).call(this);"</span>

  <span class="function"><span class="title">wrapCSMessage</span></span> = (message, filepath) -&gt;
    <span class="string">"<span class="subst">#{oj.codes?.red}</span>coffee-script error in <span class="subst">#{filepath}</span>: <span class="subst">#{message}</span><span class="subst">#{oj.codes?.reset}</span>"</span>
  <span class="function"><span class="title">wrapJSMessage</span></span> = (message, filepath) -&gt;
    <span class="string">"<span class="subst">#{oj.codes?.red}</span>javascript error in <span class="subst">#{filepath}</span>: <span class="subst">#{message}</span><span class="subst">#{oj.codes?.reset}</span>"</span>

  <span class="function"><span class="title">compileJS</span></span> = (module, code, filepath) -&gt;
    code = wrapJS code
    global.oj = oj
    module._compile code, filepath
    <span class="keyword">delete</span> global.oj</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>.oj files are compiled as javascript</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  require.extensions[<span class="string">'.oj'</span>] = (module, filepath) -&gt;
    code = stripBOM fs.readFileSync filepath, <span class="string">'utf8'</span>
    <span class="keyword">try</span>
      compileJS module, code, filepath
    <span class="keyword">catch</span> eJS
      eJS.message = wrapJSMessage eJS.message, filepath
      <span class="keyword">throw</span> eJS</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>.ojc files are compiled as coffee-script</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  require.extensions[<span class="string">'.ojc'</span>] = (module, filepath) -&gt;
    code = stripBOM fs.readFileSync filepath, <span class="string">'utf8'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Compile in coffee-script</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">try</span>
      code = coffee.compile code, bare: <span class="literal">true</span>
    <span class="keyword">catch</span> eCoffee
      eCoffee.message = wrapCSMessage eCoffee.message, filepath
      <span class="keyword">throw</span> eCoffee</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Compile javascript</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">try</span>
      compileJS module, code, filepath

    <span class="keyword">catch</span> eJS
      eJS.message = wrapJSMessage eJS.message, filepath
      <span class="keyword">throw</span> eJS</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>TODO: .ojlc files are compiled as literate coffee-script</p>
<h2>Export Model to NodeJS or globally</h2>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>  Remember root context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>root = @</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>  Define oj version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.version = <span class="string">'0.0.14'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>  Detect if this is the client or server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.isClient = <span class="keyword">not</span> process?.versions?.node</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>  Export as a module in NodeJS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">if</span> <span class="keyword">typeof</span> module != <span class="string">'undefined'</span>
  exports = module.exports = oj</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>  Export globally if not in NodeJS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">else</span>
  root[<span class="string">'oj'</span>] = oj</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h2>Type Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isDOM</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType?)
oj.<span class="function"><span class="title">isDOMElement</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType == <span class="number">1</span>)
oj.<span class="function"><span class="title">isDOMAttribute</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType == <span class="number">2</span>)
oj.<span class="function"><span class="title">isDOMText</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.nodeType == <span class="number">3</span>)

oj.<span class="function"><span class="title">isjQuery</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.jquery)
oj.<span class="function"><span class="title">isEvent</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.<span class="literal">on</span> <span class="keyword">and</span> obj.<span class="literal">off</span> <span class="keyword">and</span> obj.trigger)
oj.<span class="function"><span class="title">isOJ</span></span> = (obj) -&gt; !!(obj?.isOJ)
oj.<span class="function"><span class="title">isDefined</span></span> = (obj) -&gt; <span class="keyword">not</span> (<span class="keyword">typeof</span> obj == <span class="string">'undefined'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Type Helpers based on <a href="http://underscorejs.org/">underscore.js</a>
The potential duplication saddens me but oj needs sophisticated type detection</p>
<p>Store short names for commonly used prototypes and methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>ArrayP = Array.prototype
FuncP = Function.prototype
ObjP = Object.prototype

slice = ArrayP.slice
unshift = ArrayP.unshift
concat = ArrayP.concat</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Define</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isUndefined</span></span> = (obj) -&gt; obj == <span class="literal">undefined</span>
oj.<span class="function"><span class="title">isBoolean</span></span> = (obj) -&gt; obj == <span class="literal">true</span> <span class="keyword">or</span> obj == <span class="literal">false</span> <span class="keyword">or</span> ObjP.toString.call(obj) == <span class="string">'[object Boolean]'</span>
oj.<span class="function"><span class="title">isNumber</span></span> = (obj) -&gt; !!(obj == <span class="number">0</span> <span class="keyword">or</span> (obj <span class="keyword">and</span> obj.toExponential <span class="keyword">and</span> obj.toFixed))
oj.<span class="function"><span class="title">isString</span></span> = (obj) -&gt; !!(obj == <span class="string">''</span> <span class="keyword">or</span> (obj <span class="keyword">and</span> obj.charCodeAt <span class="keyword">and</span> obj.substr))
oj.<span class="function"><span class="title">isDate</span></span> = (obj) -&gt; !!(obj <span class="keyword">and</span> obj.getTimezoneOffset <span class="keyword">and</span> obj.setUTCFullYear)
oj.<span class="function"><span class="title">isFunction</span></span> = (obj) -&gt; <span class="keyword">typeof</span> obj == <span class="string">'function'</span>
oj.isArray = Array.isArray <span class="keyword">or</span> (obj) -&gt; ObjP.toString.call(obj) == <span class="string">'[object Array]'</span>
oj.<span class="function"><span class="title">isRegEx</span></span> = (obj) -&gt; ObjP.toString.call(obj) == <span class="string">'[object RegExp]'</span>
oj.<span class="function"><span class="title">isArguments</span></span> = (obj) -&gt; ObjP.toString.call(obj) == <span class="string">'[object Arguments]'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>typeOf: Mimic behavior of built-in typeof operator and integrate jQuery, Backbone, and OJ types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">typeOf</span></span> = (any) -&gt;

  <span class="keyword">return</span> <span class="string">'null'</span> <span class="keyword">if</span> any == <span class="literal">null</span>
  t = <span class="keyword">typeof</span> any
  <span class="keyword">if</span> t == <span class="string">'object'</span>
    <span class="keyword">if</span> oj.isArray any                     <span class="keyword">then</span> t = <span class="string">'array'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isOJ any                   <span class="keyword">then</span> t = any.typeName
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isRegEx any                <span class="keyword">then</span> t = <span class="string">'regexp'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDate any                 <span class="keyword">then</span> t = <span class="string">'date'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDOMElement any           <span class="keyword">then</span> t = <span class="string">'dom-element'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDOMText any              <span class="keyword">then</span> t = <span class="string">'dom-text'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isDOMAttribute any         <span class="keyword">then</span> t = <span class="string">'dom-attribute'</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isjQuery any               <span class="keyword">then</span> t = <span class="string">'jquery'</span>
    <span class="keyword">else</span>                                  t = <span class="string">'object'</span>
  t

oj.<span class="function"><span class="title">parse</span></span> = (str) -&gt;
  <span class="keyword">if</span> str == <span class="string">'undefined'</span>
    <span class="literal">undefined</span>
  <span class="keyword">else</span> <span class="keyword">if</span> str == <span class="string">'null'</span>
    <span class="literal">null</span>
  <span class="keyword">else</span> <span class="keyword">if</span> str == <span class="string">'true'</span>
    <span class="literal">true</span>
  <span class="keyword">else</span> <span class="keyword">if</span> str == <span class="string">'false'</span>
    <span class="literal">false</span>
  <span class="keyword">else</span> <span class="keyword">if</span> !(isNaN(number = parseFloat str))
    number
  <span class="keyword">else</span>
    str</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Determine if obj is a vanilla object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isObject</span></span> = (obj) -&gt; (oj.typeOf obj) == <span class="string">'object'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2>Utility: Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.__ = _ = {}
_.<span class="function"><span class="title">isCapitalLetter</span></span> = (c) -&gt; !!(c.match <span class="regexp">/[A-Z]/</span>)
_.<span class="function"><span class="title">identity</span></span> = (v) -&gt; v
_.<span class="function"><span class="title">property</span></span> = (obj, options = {}) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>_.defaults options, configurable: false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Object.defineProperty obj, options
_.<span class="function"><span class="title">has</span></span> = (obj, key) -&gt; ObjP.hasOwnProperty.call(obj, key)
_.keys = Object.keys || (obj) -&gt;
  <span class="keyword">throw</span> <span class="string">'Invalid object'</span> <span class="keyword">if</span> obj != Object(obj)
  keys = [];
  <span class="keyword">for</span> key <span class="keyword">of</span> obj
    <span class="keyword">if</span> _has obj, key
      keys[keys.length] = key;
  keys
_.<span class="function"><span class="title">values</span></span> = (obj) -&gt;
  <span class="keyword">throw</span> <span class="string">'Invalid object'</span> <span class="keyword">if</span> obj != Object(obj)
  out = []
  _.each obj, (v) -&gt; out.push v
  out

_.<span class="function"><span class="title">flatten</span></span> = (array, shallow) -&gt;
  _.reduce array, ((memo, value) -&gt;
    <span class="keyword">if</span> oj.isArray value
      <span class="keyword">return</span> memo.concat(<span class="keyword">if</span> shallow <span class="keyword">then</span> value <span class="keyword">else</span> _.flatten(value))
    memo[memo.length] = value
    memo
  ), []

_.<span class="function"><span class="title">reduce</span></span> = (obj = [], iterator, memo, context) -&gt;
  initial = arguments.length &gt; <span class="number">2</span>
  <span class="keyword">if</span> ArrayP.reduce <span class="keyword">and</span> obj.reduce == ArrayP.reduce
    <span class="keyword">if</span> context
      iterator = _.bind iterator, context
    <span class="keyword">return</span> <span class="keyword">if</span> initial <span class="keyword">then</span> obj.reduce iterator, memo <span class="keyword">else</span> obj.reduce iterator

  _.each obj, (value, index, list) -&gt;
    <span class="keyword">if</span> (!initial)
      memo = value
      initial = <span class="literal">true</span>
    <span class="keyword">else</span>
      memo = iterator.call context, memo, value, index, list

  <span class="keyword">if</span> !initial
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError <span class="string">'Reduce of empty array with no initial value'</span>
  memo

  <span class="function"><span class="title">ctor</span></span> = -&gt;
  _.<span class="function"><span class="title">bind</span></span> = (func, context) -&gt;
    <span class="keyword">if</span> func.bind == FuncP.bind <span class="keyword">and</span> FuncP.bind
      <span class="keyword">return</span> FuncP.bind.apply func, slice.call(arguments, <span class="number">1</span>)
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError <span class="keyword">unless</span> oj.isFunction(func)
    args = slice.call arguments, <span class="number">2</span>
    <span class="keyword">return</span> <span class="function"><span class="title">bound</span></span> = -&gt;
      <span class="keyword">unless</span> <span class="keyword">this</span> <span class="keyword">instanceof</span> bound
        <span class="keyword">return</span> func.apply context, args.concat(slice.call arguments)
      ctor.prototype = func.prototype
      self = <span class="keyword">new</span> ctor
      result = func.apply self, args.concat(slice.call(arguments))
      <span class="keyword">if</span> Object(result) == result
        <span class="keyword">return</span> result
      self

_.<span class="function"><span class="title">sortedIndex</span></span> = (array, obj, iterator = _.identity) -&gt;
  low = <span class="number">0</span>
  high = array.length;
  <span class="keyword">while</span> low &lt; high
    mid = (low + high) &gt;&gt; <span class="number">1</span>;
    <span class="keyword">if</span> iterator(array[mid]) &lt; iterator(obj) <span class="keyword">then</span> low = mid + <span class="number">1</span> <span class="keyword">else</span> high = mid;
  low</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>  TODO: Simplify this method because ArrayP.indexOf should always exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">indexOf</span></span> = (array, item, isSorted) -&gt;
  <span class="keyword">return</span> -<span class="number">1</span> <span class="keyword">unless</span> array?
  <span class="keyword">if</span> isSorted
    i = _.sortedIndex array, item
    <span class="keyword">return</span> <span class="keyword">if</span> array[i] == item <span class="keyword">then</span> i <span class="keyword">else</span> -<span class="number">1</span>
  <span class="keyword">if</span> (ArrayP.indexOf &amp;&amp; array.indexOf == ArrayP.indexOf)
    <span class="keyword">return</span> array.indexOf item
  <span class="keyword">for</span> v, i <span class="keyword">in</span> array
    <span class="keyword">if</span> v == item
      <span class="keyword">return</span> i
  -<span class="number">1</span>

_.<span class="function"><span class="title">toArray</span></span> = (obj) -&gt;
  <span class="keyword">return</span> [] <span class="keyword">if</span> !obj
  <span class="keyword">return</span> slice.call obj <span class="keyword">if</span> oj.isArray obj
  <span class="keyword">return</span> slice.call obj <span class="keyword">if</span> oj.isArguments obj
  <span class="keyword">return</span> obj.toArray() <span class="keyword">if</span> obj.toArray <span class="keyword">and</span> oj.isFunction(obj.toArray)
  _.values obj</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Determine if object or array is empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">isEmpty</span></span> = (obj) -&gt;
  <span class="keyword">return</span> obj.length == <span class="number">0</span> <span class="keyword">if</span> oj.isArray obj
  <span class="keyword">for</span> k <span class="keyword">of</span> obj
    <span class="keyword">if</span> _.has obj, k
      <span class="keyword">return</span> <span class="literal">false</span>
  <span class="literal">true</span>

_.<span class="function"><span class="title">clone</span></span> = (obj) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>TODO: support cloning OJ instances
TODO: support options, deep: true</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> obj <span class="keyword">unless</span> oj.isObject obj
  <span class="keyword">if</span> oj.isArray obj <span class="keyword">then</span> obj.slice() <span class="keyword">else</span> _.extend {}, obj

_.<span class="function"><span class="title">contains</span></span> = (obj, target) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> obj?
    <span class="keyword">return</span> <span class="literal">false</span>
  <span class="keyword">if</span> ArrayP.indexOf <span class="keyword">and</span> obj.indexOf == ArrayP.indexOf
    <span class="keyword">return</span> obj.indexOf(target) != -<span class="number">1</span>
  _.any obj, (value) -&gt; value == target

_.some = _.<span class="function"><span class="title">any</span></span> = (obj, iterator, context) -&gt;
    iterator ?= _.identity
    result = <span class="literal">false</span>
    <span class="keyword">if</span> <span class="keyword">not</span> obj?
      <span class="keyword">return</span> result
    <span class="keyword">if</span> ArrayP.some <span class="keyword">and</span> obj.some == ArrayP.some
      <span class="keyword">return</span> obj.some iterator, context
    _.each obj, (value, index, list) -&gt;
      <span class="keyword">if</span> result <span class="keyword">or</span> (result = iterator.call(context, value, index, list))
        <span class="keyword">return</span> breaker
    <span class="keyword">return</span> !!result</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h2>Utility: Iteration</h2>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>_.breaker = {}

_.<span class="function"><span class="title">each</span></span> = (col, iterator, context) -&gt;

  <span class="keyword">return</span> <span class="keyword">if</span> col == <span class="literal">null</span>
  <span class="keyword">if</span> ArrayP.forEach <span class="keyword">and</span> col.forEach == ArrayP.forEach
    col.forEach iterator, context
  <span class="keyword">else</span> <span class="keyword">if</span> oj.isArray col
    <span class="keyword">for</span> v, i <span class="keyword">in</span> col
      <span class="keyword">if</span> iterator.call(context, v, i, col) == _.breaker
        <span class="keyword">return</span> _.breaker
  <span class="keyword">else</span>
    <span class="keyword">for</span> k, v <span class="keyword">of</span> col
      <span class="keyword">if</span> _.has col, k
        <span class="keyword">if</span> iterator.call(context, v, k, col) == _.breaker
          <span class="keyword">return</span> _.breaker

_.<span class="function"><span class="title">map</span></span> = (obj, iterator, options = {}) -&gt;

  context = options.context
  recurse = options.recurse
  evaluate = options.evaluate</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Recurse if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  iterator_ = iterator
  <span class="keyword">if</span> recurse
    <span class="keyword">do</span> (options) -&gt;
      <span class="function"><span class="title">iterator_</span></span> = (v,k,o) -&gt;
        options_ = _.extend (_.clone options), (key: k, object: v)
        _.map v, iterator, options_</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Evaluate functions if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> oj.isFunction obj</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Functions pass through if evaluate isn&#39;t set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> obj <span class="keyword">unless</span> evaluate

    <span class="keyword">while</span> evaluate <span class="keyword">and</span> oj.isFunction obj
      obj = obj()

  out = obj</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Array case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> oj.isArray obj
    out = []
    <span class="keyword">return</span> out <span class="keyword">unless</span> obj
    <span class="keyword">return</span> (obj.map iterator_, context) <span class="keyword">if</span> ArrayP.map <span class="keyword">and</span> obj.map == ArrayP.map
    _.each(obj, ((v, ix, list) -&gt;
      out[out.length] = iterator_.call context, v, ix, list
    ))

    <span class="keyword">if</span> obj.length == +obj.length
      out.length = obj.length</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Object case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span> <span class="keyword">if</span> oj.isObject obj
    out = {}
    <span class="keyword">return</span> out <span class="keyword">unless</span> obj
    <span class="keyword">for</span> k,v <span class="keyword">of</span> obj</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Returning undefined will omit the thing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (r = iterator_.call(context, v, k, obj)) != <span class="literal">undefined</span>
        out[k] = r</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Basis of recursive case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">else</span>
    <span class="keyword">return</span> iterator.call context, obj, options.key, options.object,
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>  extend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">extend</span></span> = (obj) -&gt;
  _.each(slice.call(arguments, <span class="number">1</span>), ((source) -&gt;
    <span class="keyword">for</span> key, value <span class="keyword">of</span> source
      obj[key] = value
  ))
  obj</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>  _defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">defaults</span></span> = (obj) -&gt;
  _.each(slice.call(arguments, <span class="number">1</span>), ((source) -&gt;
    <span class="keyword">for</span> prop <span class="keyword">of</span> source
      <span class="keyword">if</span> <span class="keyword">not</span> obj[prop]?
        obj[prop] = source[prop]
  ))
  obj</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>  omit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">omit</span></span> = (obj) -&gt;
  copy = {}
  keys = concat.apply ArrayP, slice.call(arguments, <span class="number">1</span>)
  <span class="keyword">for</span> key <span class="keyword">of</span> obj
    <span class="keyword">if</span> <span class="keyword">not</span> _.contains keys, key
      copy[key] = obj[key]
  copy</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>  uniqueSort</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">uniqueSort</span></span> = (array, isSorted = <span class="literal">false</span>) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isSorted
    array.sort()
  out = []
  <span class="keyword">for</span> item,ix <span class="keyword">in</span> array
    <span class="keyword">if</span> ix &gt; <span class="number">0</span> <span class="keyword">and</span> array[ix-<span class="number">1</span>] == array[ix]
      <span class="keyword">continue</span>
    out.push item
  out

_.<span class="function"><span class="title">uniqueSortedUnion</span></span> = (array, array2) -&gt;
  _.uniqueSort (array.concat array2)

_.<span class="function"><span class="title">debounce</span></span> = (wait, func, immediate) -&gt;
  timeout = <span class="literal">null</span>
  result = <span class="literal">null</span>
  -&gt;
    context = @
    args = arguments
    <span class="function"><span class="title">later</span></span> = -&gt;
      timeout = <span class="literal">null</span>;
      <span class="keyword">if</span> !immediate
        result = func.apply context, args

    callNow = immediate <span class="keyword">and</span> !timeout
    clearTimeout timeout
    timeout = setTimeout later, wait
    <span class="keyword">if</span> callNow
      result = func.apply context, args
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <h2>Path Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>A simplified form of  github.com/joyent/node/lib/path.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">pathNormalizeArray</span></span> = (parts, allowAboveRoot) -&gt;
  up = <span class="number">0</span>
  i = parts.length - <span class="number">1</span>
  <span class="keyword">while</span> i &gt;= <span class="number">0</span>
    last = parts[i]
    <span class="keyword">if</span> last == <span class="string">'.'</span>
      parts.splice i, <span class="number">1</span>
    <span class="keyword">else</span> <span class="keyword">if</span> last == <span class="string">'..'</span>
      parts.splice i, <span class="number">1</span>
      up++
    <span class="keyword">else</span> <span class="keyword">if</span> up
      parts.splice i, <span class="number">1</span>
      up--
    i--

  <span class="keyword">if</span> allowAboveRoot
    <span class="keyword">while</span> up--
      parts.unshift <span class="string">'..'</span>

  parts

pathSplitRe = <span class="regexp">/^(\/?)([\s\S]+\/(?!$)|\/)?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/]*)?)$/</span>
<span class="function"><span class="title">pathSplit</span></span> = (filename) -&gt;
  result = pathSplitRe.exec filename
  [result[<span class="number">1</span>] <span class="keyword">or</span> <span class="string">''</span>, result[<span class="number">2</span>] <span class="keyword">or</span> <span class="string">''</span>, result[<span class="number">3</span>] <span class="keyword">or</span> <span class="string">''</span>, result[<span class="number">4</span>] <span class="keyword">or</span> <span class="string">''</span>]

_.<span class="function"><span class="title">pathResolve</span></span> = -&gt;
  resolvedPath = <span class="string">''</span>
  resolvedAbsolute = <span class="literal">false</span>
  i = arguments.length-<span class="number">1</span>
  <span class="keyword">while</span> i &gt;= -<span class="number">1</span> <span class="keyword">and</span> !resolvedAbsolute
    path = <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) <span class="keyword">then</span> arguments[i] <span class="keyword">else</span> process.cwd()
    <span class="keyword">if</span> (<span class="keyword">typeof</span> path != <span class="string">'string'</span>) <span class="keyword">or</span> !path
      <span class="keyword">continue</span>
    resolvedPath = path + <span class="string">'/'</span> + resolvedPath
    resolvedAbsolute = path.charAt(<span class="number">0</span>) == <span class="string">'/'</span>
    i--
  resolvedPath = pathNormalizeArray(resolvedPath.split(<span class="string">'/'</span>).filter((p) -&gt;
    <span class="keyword">return</span> !!p
  ), !resolvedAbsolute).join(<span class="string">'/'</span>)

  ((<span class="keyword">if</span> resolvedAbsolute <span class="keyword">then</span> <span class="string">'/'</span> <span class="keyword">else</span> <span class="string">''</span>) + resolvedPath) <span class="keyword">or</span> <span class="string">'.'</span>

_.<span class="function"><span class="title">pathNormalize</span></span> = (path) -&gt;
  isAbsolute = path.charAt(<span class="number">0</span>) == <span class="string">'/'</span>
  trailingSlash = path.substr(-<span class="number">1</span>) == <span class="string">'/'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Normalize the path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  path = pathNormalizeArray(path.split(<span class="string">'/'</span>).filter((p) -&gt;
    !!p
  ), !isAbsolute).join(<span class="string">'/'</span>)

  <span class="keyword">if</span> !path <span class="keyword">and</span> !isAbsolute
    path = <span class="string">'.'</span>

  <span class="keyword">if</span> path <span class="keyword">and</span> trailingSlash
    path += <span class="string">'/'</span>

  (<span class="keyword">if</span> isAbsolute <span class="keyword">then</span> <span class="string">'/'</span> <span class="keyword">else</span> <span class="string">''</span>) + path

_.<span class="function"><span class="title">pathJoin</span></span> = -&gt;
  paths = Array.prototype.slice.call arguments, <span class="number">0</span>
  _.pathNormalize(paths.filter((p, index) -&gt;
    p <span class="keyword">and</span> <span class="keyword">typeof</span> p == <span class="string">'string'</span>
  ).join(<span class="string">'/'</span>))

_.<span class="function"><span class="title">pathDirname</span></span> = (path) -&gt;
  result = pathSplit path
  root = result[<span class="number">0</span>]
  dir = result[<span class="number">1</span>]
  <span class="keyword">if</span> !root <span class="keyword">and</span> !dir</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>No dirname whatsoever</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> <span class="string">'.'</span>
  <span class="keyword">if</span> dir</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>It has a dirname, strip trailing slash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dir = dir.substr <span class="number">0</span>, dir.length - <span class="number">1</span>
  root + dir</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <h2>oj.dependency</h2>

            </div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Ensure dependencies through oj plugins</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">dependency</span></span> = (name) -&gt;
  obj = <span class="keyword">if</span> oj.isClient <span class="keyword">then</span> window[name] <span class="keyword">else</span> global[name]
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj: <span class="subst">#{name}</span> dependency is missing"</span>) <span class="keyword">unless</span> oj.isDefined obj</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Depend on jQuery</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.dependency <span class="string">'jQuery'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <h2>oj.addMethod</h2>

            </div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Add multiple methods to an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addMethods</span></span> = (obj, mapNameToMethod) -&gt;
  <span class="keyword">for</span> methodName, method <span class="keyword">of</span> mapNameToMethod
    oj.addMethod obj, methodName, method
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <h2>oj.addMethod</h2>

            </div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Add method to an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addMethod</span></span> = (obj, methodName, method) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>  Validate input</p>
<p>throw &#39;oj.addMethod: object expected for first argument&#39; unless oj.isObject obj</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="string">'oj.addMethod: string expected for second argument'</span> <span class="keyword">unless</span> oj.isString methodName
  <span class="keyword">throw</span> <span class="string">'oj.addMethod: function expected for thrid argument'</span> <span class="keyword">unless</span> oj.isFunction method</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>  Methods are non-enumerable, non-writable properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Object.defineProperty obj, methodName,
    value: method
    enumerable: <span class="literal">false</span>
    writable: <span class="literal">false</span>
    configurable: <span class="literal">true</span>
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <h2>oj.removeMethod</h2>

            </div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Remove a method from an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">removeMethod</span></span> = (obj, methodName) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>  Validate inputs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="string">'oj.removeMethod: string expected for second argument'</span> <span class="keyword">unless</span> oj.isString methodName</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>  Remove the method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">delete</span> obj[methodName]
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <h2>oj.addProperties</h2>

            </div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Add multiple properties to an object</p>
<p>Properties can be specified by get/set methods or by a value</p>
<p>Value Property:
<code>age: 7    # defaults to {writable:true, enumerable:true}</code></p>
<p>Value Property with specified writable/enumerable:
<code>age: {value:7, writable:false, enumerable:false}</code></p>
<p>Readonly Get Property
<code>age: {get:(-&gt; 7)}</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addProperties</span></span> = (obj, mapNameToInfo) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>  Iterate over properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> propName, propInfo <span class="keyword">of</span> mapNameToInfo</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>  Wrap the value if propInfo is not already a property definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> <span class="keyword">not</span> propInfo?.get? <span class="keyword">and</span> <span class="keyword">not</span> propInfo?.value?
      propInfo = value: propInfo, writable:<span class="literal">true</span>

    oj.addProperty obj, propName, propInfo

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <h2>oj.addProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">addProperty</span></span> = (obj, propName, propInfo) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Validate input</p>
<p>throw new Error(&#39;oj.addProperty: obj expected for first argument&#39;) unless oj.isObject obj</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.addProperty: string expected for second argument'</span>) <span class="keyword">unless</span> oj.isString propName

  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.addProperty: object expected for third argument'</span>) <span class="keyword">unless</span> oj.isObject propInfo</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Default properties to enumerable and configurable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.defaults propInfo,
    enumerable: <span class="literal">true</span>
    configurable: <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Remove property if it already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> Object.getOwnPropertyDescriptor(obj, propName)?
    oj.removeProperty obj, propName</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Add the property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Object.defineProperty obj, propName, propInfo
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <h2>oj.removeProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">removeProperty</span></span> = (obj, propName) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Validate input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="string">'oj.addProperty: string expected for second argument'</span> <span class="keyword">unless</span> oj.isString propName</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Remove property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">delete</span> obj[propName]</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <h2>oj.isProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Determine if the specified key is was defined by addProperty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">isProperty</span></span> = (obj, propName) -&gt;
  <span class="keyword">throw</span> <span class="string">'oj.isProperty: string expected for second argument'</span> <span class="keyword">unless</span> oj.isString propName

  Object.getOwnPropertyDescriptor(obj, propName).get?</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <h2>oj.copyProperty</h2>

            </div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Determine copy source.propName to dest.propName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">copyProperty</span></span> = (dest, source, propName) -&gt;
  info = Object.getOwnPropertyDescriptor source, propName
  Object.defineProperty dest, propName, info</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <h2>_.arguments</h2>

            </div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Abstraction to wrap global arguments stack. This makes me sad but it is necessary for div -&gt; syntax</p>
<p>  Stack of results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.argumentsStack = []</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>  Result is top of the stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.addProperty _, <span class="string">'arguments'</span>, get: -&gt; <span class="keyword">if</span> _.argumentsStack.length <span class="keyword">then</span> _.argumentsStack[_.argumentsStack.length-<span class="number">1</span>] <span class="keyword">else</span> <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>  Push scope onto arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">argumentsPush</span></span> = (args = []) -&gt;
  _.argumentsStack.push args
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>  Pop scope from arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">argumentsPop</span></span> = -&gt;
  <span class="keyword">if</span> _.argumentsStack.length
    <span class="keyword">return</span> _.argumentsStack.pop()
  <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>  Append argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">argumentsAppend</span></span> = (arg) -&gt;
  <span class="keyword">if</span> _.arguments
    _.arguments.push arg
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <h2>oj.tag (name, attributes, content, content, ...)</h2>

            </div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">tag</span></span> = (name, args...) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p><em>name</em>: String of tag to serialize
<em>attributes</em>: (Optional) Object defining attributes of tag being serialized</p>
<p>Styles have smart mappings:</p>
<p><code>c</code>  will map to <code>class</code>
<code>fontSize</code> will map to <code>font-size</code>
<code>borderRadius</code> will map to <code>moz-border-radius</code>, etc.</p>
<p>Validate input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="string">'oj.tag error: argument 1 is not a string (expected tag name)'</span> <span class="keyword">unless</span> oj.isString name</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Build ojml starting with tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ojml = [name]</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Get attributes from args by unioning all objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  attributes = {}
  <span class="keyword">for</span> arg <span class="keyword">in</span> args</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>TODO: evaluate argument if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> oj.isObject arg
      _.extend attributes, arg</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Help the attributes out as they have shitting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  attributes = _upgradeTagMethod name, attributes</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Add attributes to ojml if they exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ojml.push attributes <span class="keyword">unless</span> _.isEmpty attributes</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Push arguments to build up children tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.argumentsPush ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Loop over attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> arg <span class="keyword">in</span> args
    <span class="keyword">if</span> oj.isObject arg
      <span class="keyword">continue</span>
    <span class="keyword">else</span> <span class="keyword">if</span> oj.isFunction arg

      len = _.arguments.length</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Call the argument it will auto append to _.arguments which is ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      r = arg()</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Use return value if _.arguments weren&#39;t changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> len == _.arguments.length <span class="keyword">and</span> r?
        _.argumentsAppend r

    <span class="keyword">else</span>
      _.argumentsAppend arg</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>  Pop to restore previous context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.argumentsPop()</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>  Append the final result to your parent&#39;s arguments
  if there exists an argument to append to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.argumentsAppend ojml

  ojml

oj.tag.elements =
  closed: <span class="string">'a abbr acronym address applet article aside audio b bdo big blockquote body button canvas caption center cite code colgroup command datalist dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer form frameset h1 h2 h3 h4 h5 h6 head header hgroup html i iframe ins keygen kbd label legend li map mark menu meter nav noframes noscript object ol optgroup option output p pre progress q rp rt ruby s samp script section select small source span strike strong style sub summary sup table tbody td textarea tfoot th thead time title tr tt u ul var video wbr xmp'</span>.split <span class="string">' '</span>
  open: <span class="string">'area base br col command css !DOCTYPE embed hr img input keygen link meta param source track wbr'</span>.split <span class="string">' '</span>

oj.tag.elements.all = (oj.tag.elements.closed.concat oj.tag.elements.open).sort()

oj.tag.<span class="function"><span class="title">isClosed</span></span> = (tag) -&gt;
  (_.indexOf oj.tag.elements.open, tag, <span class="literal">true</span>) == -<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Helper to set tag name on a tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_setTagName</span></span> = (tag, name) -&gt;
  <span class="keyword">if</span> tag?
    tag.tagName = name
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Helper to get tag name on a tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_getTagName</span></span> = (tag) -&gt;
  tag.tagName</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Helper to get instance on element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_getInstanceOnElement</span></span> = (el) -&gt;
  <span class="keyword">if</span> el?.oj?
    el.oj
  <span class="keyword">else</span>
    <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Helper to set instance on element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_setInstanceOnElement</span></span> = (el, inst) -&gt;
  el?.oj = inst
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Create tag methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">for</span> t <span class="keyword">in</span> oj.tag.elements.all
  <span class="keyword">do</span> (t) -&gt;
    oj[t] = -&gt; oj.tag t, arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Remember the tag name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _setTagName oj[t], t</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Clear attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_defaultClear</span></span> = (dest, d, e) -&gt;
  _.defaults dest, d
  <span class="keyword">for</span> k <span class="keyword">of</span> e
    <span class="keyword">delete</span> dest[k]
  dest</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Adjust tag attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_upgradeTagMethod</span></span> = (name, attributes) -&gt;
  attr = _.clone attributes
  <span class="keyword">switch</span> name</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>link tags default to stylesheet, text/css, url instead of href</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">when</span> <span class="string">'link'</span> <span class="keyword">then</span> _defaultClear attr, {rel:<span class="string">'stylesheet'</span>, type:<span class="string">'text/css'</span>, href: attr.url <span class="keyword">or</span> attr.src}, {url:<span class="number">0</span>, src:<span class="number">0</span>}</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>script tags default to javascript, url instead of src</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">when</span> <span class="string">'script'</span> <span class="keyword">then</span> _defaultClear attr, {type:<span class="string">'text/javascript'</span>, src: attr.url}, url:<span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>anchor tags can use url instead of href</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">when</span> <span class="string">'a'</span> <span class="keyword">then</span> _defaultClear attr, {href:attr.url}, url:<span class="number">0</span>
  attr</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <h2>doctype tag</h2>

            </div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>dhp = <span class="string">'&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01'</span>
w3 = <span class="string">'"http://www.w3.org/TR/html4/'</span>
strict5 = <span class="string">'&lt;!DOCTYPE html&gt;'</span>
strict4 = dhp+<span class="string">'//EN" '</span>+w3+<span class="string">'strict.dtd"&gt;'</span>

doctypes =
  <span class="string">'5'</span>: strict5
  <span class="string">'HTML 5'</span>: strict5
  <span class="string">'4'</span>: strict4
  <span class="string">'HTML 4.01 Strict'</span>: strict4
  <span class="string">'HTML 4.01 Frameset'</span>: dhp+<span class="string">' Frameset//EN" '</span>+w3+<span class="string">'frameset.dtd"&gt;'</span>
  <span class="string">'HTML 4.01 Transitional'</span>: dhp+<span class="string">' Transitional//EN" '</span>+w3+<span class="string">'loose.dtd"&gt;'</span>

oj.<span class="function"><span class="title">doctype</span></span> = (type = <span class="number">5</span>) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Emit like a tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ojml = doctypes[type]
  _.argumentsAppend ojml
  ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <h2>oj.page</h2>

            </div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>General template for oj to not need html, head, body tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">page</span></span> = (options, content) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Options is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> content?
    content = options
    options = {}

  oj.html -&gt;
    oj.head -&gt;
      <span class="keyword">if</span> options.title?
        oj.title options.title
    oj.body -&gt;
      content()</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>oj.styles = ()</p>
<h2>oj.extend (context)</h2>

            </div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <pre><code>Extend oj methods into a context. Common contexts are `global` `window`
and `this` (used in coffee script). Helper methods are not extended (oj._)

context          Object to extend oj methods and objects into</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">extend</span></span> = (context) -&gt;
  o = {}
  <span class="keyword">for</span> k,v <span class="keyword">of</span> oj
    <span class="keyword">if</span> k[<span class="number">0</span>] != <span class="string">'_'</span>
      o[k] = v
  <span class="keyword">delete</span> o.extend
  _.extend context, o</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <h2>oj.compile</h2>

            </div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Compile ojml into meaningful parts
options
    html:true           Compile to html
    dom:true            Compile to dom
    css:true            Compile to css
    debug:true          Keep all source including comments
    ignore:{html:1}     Map of tags to ignore while compiling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">compile</span></span> = (options, ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Options is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> ojml?
    ojml = options
    options = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Default options to compile everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options = _.defaults {}, options,
    html: <span class="literal">true</span>
    dom: <span class="literal">true</span>
    css: <span class="literal">true</span>
    cssMap: <span class="literal">false</span>
    debug: <span class="literal">false</span>
    ignore: {}</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Always ignore oj and css tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend options.ignore, oj:<span class="number">1</span>, css:<span class="number">1</span>

  acc = _.clone options
  acc.html = <span class="keyword">if</span> options.html <span class="keyword">then</span> [] <span class="keyword">else</span> <span class="literal">null</span>    <span class="comment"># html accumulator</span>
  acc.dom = <span class="keyword">if</span> options.dom <span class="keyword">and</span> document? <span class="keyword">then</span> (document.createElement <span class="string">'OJ'</span>) <span class="keyword">else</span> <span class="literal">null</span>
  acc.css = <span class="keyword">if</span> options.css || options.cssMap <span class="keyword">then</span> {} <span class="keyword">else</span> <span class="literal">null</span>
  acc.indent = <span class="string">''</span>                                 <span class="comment"># indent counter</span>
  acc.types = [] <span class="keyword">if</span> options.dom                   <span class="comment"># remember types if making dom</span>
  acc.tags = {}                                   <span class="comment"># remember what tags were used</span>
  _compileAny ojml, acc</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Generate cssMap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.cssMap
    cssMap = acc.css</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Generate css</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.css
    css = _cssFromObject acc.css, options.debug</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Generate HTML</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.html
    html = acc.html.join <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Generate dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.dom</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Remove the <oj> wrapping from the dom element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dom = acc.dom.childNodes</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Cleanup inconsistencies of childNodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> dom.length?</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Make dom a real array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      dom = _.toArray dom</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Filter out anything that isn&#39;t a dom element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      dom = dom.filter (v) -&gt; oj.isDOM(v)</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Ensure dom is null if empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> dom.length == <span class="number">0</span>
      dom = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Single elements are returned themselves not as a list
Reasoning: The common cases don&#39;t have multiple elements <html>,<body>
or the complexity doesn&#39;t matter because insertion is abstracted for you
In short it is easier to check for _.isArray dom, then _isArray dom &amp;&amp; dom.length &gt; 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">else</span> <span class="keyword">if</span> dom.length == <span class="number">1</span>
      dom = dom[<span class="number">0</span>]

  out = html:html, dom:dom, css:css, cssMap:cssMap, types:acc.types, tags:acc.tags

  out

<span class="function"><span class="title">_styleKeyFromFancy</span></span> = (key) -&gt;
  out = <span class="string">""</span></pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Loop over characters in key looking for camal case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> c <span class="keyword">in</span> key
    <span class="keyword">if</span> _.isCapitalLetter c
      out += <span class="string">"-<span class="subst">#{c.toLowerCase()}</span>"</span>
    <span class="keyword">else</span>
      out += c
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <h2>_styleFromObject: Convert object to string form</h2>

            </div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <pre><code>inline:false      inline:true                inline:false,indent:true
color:red;        color:red;font-size:10px   \tcolor:red;
font-size:10px;                              \tfont-size:10px;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_styleFromObject</span></span> = (obj, options = {}) -&gt;
  _.defaults options,
    inline: <span class="literal">true</span>
    indent: <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Trailing semi should only exist on when we aren&#39;t indenting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.semi = !options.inline
  out = <span class="string">""</span>
  keys = _.keys(obj).sort()
  indent = <span class="keyword">if</span> options.indent <span class="keyword">then</span> <span class="string">'\t'</span> <span class="keyword">else</span> <span class="string">''</span>
  newline = <span class="keyword">if</span> options.inline <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">'\n'</span>
  <span class="keyword">for</span> kFancy,ix <span class="keyword">in</span> keys</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Add semi if it is not inline or it is not the last key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    semi = <span class="keyword">if</span> options.semi <span class="keyword">or</span> ix != keys.length-<span class="number">1</span> <span class="keyword">then</span> <span class="string">";"</span> <span class="keyword">else</span> <span class="string">''</span>
    k = _styleKeyFromFancy kFancy
    out += <span class="string">"<span class="subst">#{indent}</span><span class="subst">#{k}</span>:<span class="subst">#{obj[kFancy]}</span><span class="subst">#{semi}</span><span class="subst">#{newline}</span>"</span>
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <h2>_attributesFromObject: Convert object to attribute string</h2>

            </div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>This object has nothing special. No renamed keys, no jquery events. It is
precicely what must be serialized with no adjustment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesFromObject</span></span> = (obj) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>Pass through non objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> obj <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject obj

  out = <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>Serialize attributes in order for consistent output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  space = <span class="string">''</span>
  <span class="keyword">for</span> k <span class="keyword">in</span> _.keys(obj).sort()
    v = obj[k]</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>Boolean attributes have no value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (v == <span class="literal">true</span>)
      out += <span class="string">"<span class="subst">#{space}</span><span class="subst">#{k}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Other attributes have a value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">else</span>
      out += <span class="string">"<span class="subst">#{space}</span><span class="subst">#{k}</span>=\"<span class="subst">#{v}</span>\""</span>

    space = <span class="string">' '</span>
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <h2>_cssFromObject:</h2>

            </div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>Convert css selectors and rules to a string</p>
<p>debug:true               debug:false
.cls {                   .cls{color: red}
  color: red;
}\n</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_cssFromObject</span></span> = (cssMap, isDebug = <span class="number">0</span>) -&gt;
  newline = <span class="keyword">if</span> isDebug <span class="keyword">then</span> <span class="string">'\n'</span> <span class="keyword">else</span> <span class="string">''</span>
  space = <span class="keyword">if</span> isDebug <span class="keyword">then</span> <span class="string">' '</span> <span class="keyword">else</span> <span class="string">''</span>
  inline = !isDebug
  indent = isDebug
  css = <span class="string">''</span>
  <span class="keyword">for</span> selector, styles <span class="keyword">of</span> cssMap
    rules = _styleFromObject styles, inline:inline, indent:indent
    css += <span class="string">"<span class="subst">#{selector}</span><span class="subst">#{space}</span>{<span class="subst">#{newline}</span><span class="subst">#{rules}</span>}<span class="subst">#{newline}</span>"</span>
  css</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <h2>_compileDeeper:</h2>

            </div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Recursive helper for compiling that wraps indention</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_compileDeeper</span></span> = (method, ojml, options) -&gt;
  i = options.indent
  options.indent += <span class="string">'\t'</span>
  method ojml, options
  options.indent = i</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Compile ojml or any type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">pass</span></span> = -&gt;
<span class="function"><span class="title">_compileAny</span></span> = (ojml, options) -&gt;

  <span class="keyword">switch</span> oj.typeOf ojml

    <span class="keyword">when</span> <span class="string">'array'</span>
      _compileTag ojml, options

    <span class="keyword">when</span> <span class="string">'jquery'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>TODO: Missing unit tests for the jquery case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      options.html?.push ojml.html()
      options.dom?.concat ojml.get()

    <span class="keyword">when</span> <span class="string">'string'</span>
      options.html?.push ojml
      <span class="keyword">if</span> ojml.length &gt; <span class="number">0</span> <span class="keyword">and</span> ojml[<span class="number">0</span>] == <span class="string">'&lt;'</span>
        root = document.createElement <span class="string">'div'</span>
        root.innerHTML = ojml
        els = root.childNodes
        options.dom?.appendChild root</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>for el in els
  options.dom?.appendChild el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span>
        options.dom?.appendChild document.createTextNode ojml

    <span class="keyword">when</span> <span class="string">'boolean'</span>, <span class="string">'number'</span>
      options.html?.push <span class="string">"<span class="subst">#{ojml}</span>"</span>
      options.dom?.appendChild document.createTextNode <span class="string">"<span class="subst">#{ojml}</span>"</span>

    <span class="keyword">when</span> <span class="string">'function'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Wrap function call to allow full oj generation within ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _compileAny (oj ojml), options

    <span class="keyword">when</span> <span class="string">'date'</span>
      options.html?.push <span class="string">"<span class="subst">#{ojml.toLocaleString()}</span>"</span>
      options.dom?.appendChild document.createTextNode <span class="string">"<span class="subst">#{ojml.toLocaleString()}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Do nothing for &#39;null&#39;, &#39;undefined&#39;, &#39;object&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">when</span> <span class="string">'null'</span> <span class="keyword">then</span> <span class="keyword">break</span>
    <span class="keyword">when</span> <span class="string">'undefined'</span> <span class="keyword">then</span> <span class="keyword">break</span>
    <span class="keyword">when</span> <span class="string">'object'</span> <span class="keyword">then</span> <span class="keyword">break</span>

    <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>OJ type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isOJ ojml
        options.types?.push ojml
        options.html?.push ojml.toHTML()
        options.dom?.appendChild ojml.toDOM()
        <span class="keyword">if</span> options.css?
          _.extend options.css, ojml.toCSSMap()

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>Supported events from jquery</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>jqueryEvents = bind:<span class="number">1</span>, <span class="literal">on</span>:<span class="number">1</span>, <span class="literal">off</span>:<span class="number">1</span>, live:<span class="number">1</span>, blur:<span class="number">1</span>, change:<span class="number">1</span>, click:<span class="number">1</span>, dblclick:<span class="number">1</span>, focus:<span class="number">1</span>, focusin:<span class="number">1</span>, focusout:<span class="number">1</span>, hover:<span class="number">1</span>, keydown:<span class="number">1</span>, keypress:<span class="number">1</span>, keyup:<span class="number">1</span>, mousedown:<span class="number">1</span>, mouseenter:<span class="number">1</span>, mousemove:<span class="number">1</span>, mouseout:<span class="number">1</span>, mouseup:<span class="number">1</span>, ready:<span class="number">1</span>, resize:<span class="number">1</span>, scroll:<span class="number">1</span>, select:<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>Compile ojml tag (an array)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_compileTag</span></span> = (ojml, options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>Empty list compiles to nothing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> <span class="keyword">if</span> ojml.length == <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>Get tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tag = ojml[<span class="number">0</span>]
  tagType = <span class="keyword">typeof</span> tag</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>Allow ojml&#39;s tag parameter to be &#39;table&#39; or table or Table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tag = <span class="keyword">if</span> (tagType == <span class="string">'function'</span> <span class="keyword">or</span> tagType == <span class="string">'object'</span>) <span class="keyword">and</span> _getTagName(tag)? <span class="keyword">then</span> _getTagName(tag) <span class="keyword">else</span> tag</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>Fail if we couldn&#39;t find a string by now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.compile: tag name is missing'</span>) <span class="keyword">unless</span> oj.isString(tag) <span class="keyword">and</span> tag.length &gt; <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>Create oj object if tag is capitalized</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> _.isCapitalLetter tag[<span class="number">0</span>]
    <span class="keyword">return</span> _compileDeeper _compileAny, (<span class="keyword">new</span> oj[tag] ojml.slice(<span class="number">1</span>)), options</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>Record tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.tags[tag] = <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>Get attributes (optional)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  attributes = <span class="literal">null</span>
  <span class="keyword">if</span> oj.isObject ojml[<span class="number">1</span>]
    attributes = ojml[<span class="number">1</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>Remaining arguments are children of this tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  children = <span class="keyword">if</span> attributes <span class="keyword">then</span> ojml.slice <span class="number">2</span> <span class="keyword">else</span> ojml.slice <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>Compile to css if requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.css <span class="keyword">and</span> tag == <span class="string">'css'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>Extend options.css with rules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> selector,styles <span class="keyword">of</span> attributes
      options.css[selector] ?= styles
      _.extend options.css[selector], styles</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>Compile to html if requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> options.ignore[tag]

    events = _attributesProcessedForOJ attributes</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>Add dom element with attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.dom <span class="keyword">and</span> document?</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>Create element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      el = document.createElement tag</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>Add self to parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isDOMElement options.dom
        options.dom.appendChild el</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>Push ourselves on the dom stack (to handle children)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      options.dom = el</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>Set attributes in sorted order for consistency</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isObject attributes
        <span class="keyword">for</span> attrName <span class="keyword">in</span> _.keys(attributes).sort()
          attrValue = attributes[attrName]</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>Boolean attributes have no value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">if</span> attrValue == <span class="literal">true</span>
            att = document.createAttribute attrName
            el.setAttributeNode att
          <span class="keyword">else</span>
            el.setAttribute attrName, attrValue</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>Bind events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _attributesBindEventsToDOM events, el</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>Add tag with attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.html
      attr = (_attributesFromObject attributes) ? <span class="string">''</span>
      space = <span class="keyword">if</span> attr == <span class="string">''</span> <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">' '</span>
      options.html.push <span class="string">"&lt;<span class="subst">#{tag}</span><span class="subst">#{space}</span><span class="subst">#{attr}</span>&gt;"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>Compile your children if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> child <span class="keyword">in</span> children</pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>Skip intention if there is only one child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.debug &amp;&amp; children.length &gt; <span class="number">1</span>
      options.html?.push <span class="string">"\n\t<span class="subst">#{options.indent}</span>"</span>
    _compileDeeper _compileAny, child, options</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>Skip intention if there is only one child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> options.debug &amp;&amp; children.length &gt; <span class="number">1</span>
    options.html?.push <span class="string">"\n<span class="subst">#{options.indent}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>End html tag if you have children or your tag closes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> options.ignore[tag]</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Close tag if html</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.html <span class="keyword">and</span> (children.length &gt; <span class="number">0</span> <span class="keyword">or</span> oj.tag.isClosed(tag))
      options.html?.push <span class="string">"&lt;/<span class="subst">#{tag}</span>&gt;"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>Pop ourselves if dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> options.dom
      options.dom = options.dom.parentNode

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>Allow attributes to take style as an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributeStyleAllowsObject</span></span> = (attr) -&gt;
  <span class="keyword">if</span> oj.isObject attr?.style
    attr.style = _styleFromObject attr.style, inline:<span class="literal">true</span>
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>Allow attributes to alias c to class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributeCMeansClass</span></span> = (attr) -&gt;
  <span class="keyword">if</span> attr?.c?
    attr.<span class="class"><span class="keyword">class</span> = <span class="title">attr</span>.<span class="title">c</span></span>
    <span class="keyword">delete</span> attr.c
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>Allow attributes to take class as an array of strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributeClassAllowsArrays</span></span> = (attr) -&gt;
  <span class="keyword">if</span> oj.isArray attr?.<span class="class"><span class="keyword">class</span>
    <span class="title">attr</span>.<span class="title">class</span> = <span class="title">attr</span>.<span class="title">join</span> ' '</span>
  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>Omit falsy values except for zero</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributeOmitFalsyValues</span></span> = (attr) -&gt;
  <span class="keyword">if</span> oj.isObject attr</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>Filter out falsy except for 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> k,v <span class="keyword">of</span> attr
      <span class="keyword">delete</span> attr[k] <span class="keyword">if</span> v == <span class="literal">null</span> <span class="keyword">or</span> v == <span class="literal">undefined</span> <span class="keyword">or</span> v == <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>Filter out jquery events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesFilterOutEvents</span></span> = (attr) -&gt;
  out = {}
  <span class="keyword">if</span> oj.isObject attr</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>Filter out attributes that are jqueryEvents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> k,v <span class="keyword">of</span> attr</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>If this attribute (k) is an event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> jqueryEvents[k]?
        out[k] = v
        <span class="keyword">delete</span> attr[k]
  out</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>All the OJ magic for attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesProcessedForOJ</span></span> = (attr) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>Alias c to class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _attributeCMeansClass attr</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>style takes objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _attributeStyleAllowsObject attr</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>class takes arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _attributeClassAllowsArrays attr</pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>Omit keys that false, null, or undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _attributeOmitFalsyValues attr</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>TODO: Consider jsoning anything that isn&#39;t a string
any keys that aren&#39;t strings are jsoned
_attributesJSONAllKeys attributes</p>
<p>Filter out jquery events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  events = _attributesFilterOutEvents attr</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>Returns bindable events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  events</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>Bind events to dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_attributesBindEventsToDOM</span></span> = (events, el) -&gt;
  <span class="keyword">for</span> ek, ev <span class="keyword">of</span> events
    <span class="keyword">if</span> $?
      <span class="keyword">if</span> oj.isArray ev
        $(el)[ek].apply @, ev
      <span class="keyword">else</span>
        $(el)[ek](ev)
    <span class="keyword">else</span>
      console.error <span class="string">"oj: jquery is missing when binding a '<span class="subst">#{ek}</span>' event"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <h2>oj.toHTML</h2>

            </div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>Make oj directly to HTML. It will ignore all event bindings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">toHTML</span></span> = (options, ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>Options is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject options
    ojml = options
    options = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>Create html only</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend options,
    dom: <span class="literal">false</span>
    js: <span class="literal">false</span>
    html: <span class="literal">true</span>
    css: <span class="literal">false</span>

  (oj.compile options, ojml).html</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <h2>oj.toCSS</h2>

            </div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>Make oj directly to css. It will ignore all event bindings and html</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">toCSS</span></span> = (options, ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-231">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-231">&#182;</a>
              </div>
              <p>Options is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject options
    ojml = options
    options = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-232">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-232">&#182;</a>
              </div>
              <p>Create html only</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend options,
    dom: <span class="literal">false</span>
    js: <span class="literal">false</span>
    html: <span class="literal">false</span>
    css: <span class="literal">true</span>

  (oj.compile options, ojml).css</pre></div></div>
            
        </li>
        
        
        <li id="section-233">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-233">&#182;</a>
              </div>
              <h2>_.inherit</h2>

            </div>
            
        </li>
        
        
        <li id="section-234">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-234">&#182;</a>
              </div>
              <p>Based on, but sadly incompatable with, coffeescript inheritance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.<span class="function"><span class="title">inherit</span></span> = (child, parent) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-235">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-235">&#182;</a>
              </div>
              <p>Copy class properties and methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> key <span class="keyword">of</span> parent
    oj.copyProperty child, parent, key

  <span class="function"><span class="title">ctor</span></span> = -&gt;
  ctor:: = parent::
  child:: = <span class="keyword">new</span> ctor()</pre></div></div>
            
        </li>
        
        
        <li id="section-236">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-236">&#182;</a>
              </div>
              <p>Provide easy access for base class methods
Example: Parent.base.methodName(arguments...)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  child.base = parent::

  <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-237">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-237">&#182;</a>
              </div>
              <h2>oj.argumentShift</h2>

            </div>
            
        </li>
        
        
        <li id="section-238">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-238">&#182;</a>
              </div>
              <p>Helper to make argument handling easier</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">argumentShift</span></span> = (args, key) -&gt;
  <span class="keyword">if</span> (oj.isObject args) <span class="keyword">and</span> key? <span class="keyword">and</span> args[key]?
    value = args[key]
    <span class="keyword">delete</span> args[key]
  value</pre></div></div>
            
        </li>
        
        
        <li id="section-239">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-239">&#182;</a>
              </div>
              <h2>oj.type</h2>

            </div>
            
        </li>
        
        
        <li id="section-240">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-240">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">type</span></span> = (name, args = {}) -&gt;
  <span class="keyword">throw</span> <span class="string">'oj.type: string expected for first argument'</span> <span class="keyword">unless</span> oj.isString name
  <span class="keyword">throw</span> <span class="string">'oj.type: object expected for second argument'</span> <span class="keyword">unless</span> oj.isObject args

  args.methods ?= {}
  args.properties ?= {}</pre></div></div>
            
        </li>
        
        
        <li id="section-241">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-241">&#182;</a>
              </div>
              <p>When auto newing you need to delay construct the properties
or they will be constructed twice.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  delay = <span class="string">'__DELAYED__'</span>
  Out = <span class="keyword">new</span> Function(<span class="string">"""return function <span class="subst">#{name}</span>(){
    var _this = this;
    if ( !(this instanceof <span class="subst">#{name}</span>) ) {
      _this = new <span class="subst">#{name}</span>('<span class="subst">#{delay}</span>');
      _this.__autonew__ = true;
    }

    if (arguments &amp;&amp; arguments[0] != '<span class="subst">#{delay}</span>')
      <span class="subst">#{name}</span>.prototype.constructor.apply(_this, arguments);

    return _this;
  }
  """</span>
  )();</pre></div></div>
            
        </li>
        
        
        <li id="section-242">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-242">&#182;</a>
              </div>
              <p>Default the constructor to call its base</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> args.base? <span class="keyword">and</span> ((<span class="keyword">not</span> args.constructor?) <span class="keyword">or</span> (<span class="keyword">not</span> args.hasOwnProperty(<span class="string">'constructor'</span>)))
    args.<span class="function"><span class="title">constructor</span></span> = -&gt;
      Out.base?.constructor.apply @, arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-243">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-243">&#182;</a>
              </div>
              <p>Inherit if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> args.base?
    _.inherit Out, args.base</pre></div></div>
            
        </li>
        
        
        <li id="section-244">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-244">&#182;</a>
              </div>
              <p>Add the constructor as a method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addMethod Out::, <span class="string">'constructor'</span>, args.constructor</pre></div></div>
            
        </li>
        
        
        <li id="section-245">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-245">&#182;</a>
              </div>
              <p>Mark new type and its instances with a non-enumerable type and isOJ properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  typeProps =
    type: {value:Out, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span>}
    typeName: {value:name, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span>}
    isOJ: {value:<span class="literal">true</span>, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span>}
  oj.addProperties Out, typeProps
  oj.addProperties Out::, typeProps</pre></div></div>
            
        </li>
        
        
        <li id="section-246">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-246">&#182;</a>
              </div>
              <p>Add properties helper to instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  propKeys = (_.keys args.properties).sort()
  <span class="keyword">if</span> Out::properties?
    propKeys = _.uniqueSortedUnion Out::properties, propKeys
  properties = value:propKeys, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-247">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-247">&#182;</a>
              </div>
              <p>propKeys.has = _.reduce propKeys, ((o,item) -&gt; o[item.key] = true; o), {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addProperty Out::, <span class="string">'properties'</span>, properties</pre></div></div>
            
        </li>
        
        
        <li id="section-248">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-248">&#182;</a>
              </div>
              <p>Add methods helper to instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  methodKeys = (_.keys args.methods).sort()
  <span class="keyword">if</span> Out::methods?
    methodKeys = _.uniqueSortedUnion Out::methods, methodKeys
  methods = value:methodKeys, writable:<span class="literal">false</span>, enumerable:<span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-249">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-249">&#182;</a>
              </div>
              <p>methodKeys.has = _.reduce methodKeys, ((o,item) -&gt; o[item.key] = true; o), {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addProperty Out::, <span class="string">'methods'</span>, methods</pre></div></div>
            
        </li>
        
        
        <li id="section-250">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-250">&#182;</a>
              </div>
              <p>Add methods to the type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend args.methods,</pre></div></div>
            
        </li>
        
        
        <li id="section-251">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-251">&#182;</a>
              </div>
              <p>get: Get all properties, or get a single property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    get: (k) -&gt;
      <span class="keyword">if</span> oj.isString k
        <span class="keyword">if</span> <span class="property">@has</span> k
          <span class="keyword">return</span> @[k]
        <span class="keyword">else</span>
          <span class="keyword">return</span> <span class="literal">undefined</span>
      <span class="keyword">else</span>
        out = {}
        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="property">@properties</span>
          out[p] = @[p]
        out</pre></div></div>
            
        </li>
        
        
        <li id="section-252">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-252">&#182;</a>
              </div>
              <p>set: Set all properties on the object at once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    set: (k,v) -&gt;
      obj = k</pre></div></div>
            
        </li>
        
        
        <li id="section-253">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-253">&#182;</a>
              </div>
              <p>Optionally take key, value instead of object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> <span class="keyword">not</span> oj.isObject k
        obj = {}
        obj[k] = v;</pre></div></div>
            
        </li>
        
        
        <li id="section-254">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-254">&#182;</a>
              </div>
              <p>Set all keys that are valid properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span> key,value <span class="keyword">of</span> obj
        <span class="keyword">if</span> <span class="property">@has</span> key
          @[key] = value
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-255">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-255">&#182;</a>
              </div>
              <p>has: Determine if property exists
TODO: Make this O(1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    has: (k) -&gt;
      _.some <span class="property">@properties</span>, (v) -&gt; v == k</pre></div></div>
            
        </li>
        
        
        <li id="section-256">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-256">&#182;</a>
              </div>
              <p>can: Determine if method exists
TODO: Make this O(1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    can: (k) -&gt;
      _.some <span class="property">@methods</span>, (v) -&gt; v == k</pre></div></div>
            
        </li>
        
        
        <li id="section-257">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-257">&#182;</a>
              </div>
              <p>toJSON: Use properties to generate json</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON: -&gt;
      json = {}
      <span class="keyword">for</span> prop <span class="keyword">in</span> <span class="property">@properties</span>
        json[prop] = @[prop]
      json</pre></div></div>
            
        </li>
        
        
        <li id="section-258">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-258">&#182;</a>
              </div>
              <p>Add methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addMethods Out::, args.methods</pre></div></div>
            
        </li>
        
        
        <li id="section-259">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-259">&#182;</a>
              </div>
              <p>Add the properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oj.addProperties Out::, args.properties

  Out</pre></div></div>
            
        </li>
        
        
        <li id="section-260">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-260">&#182;</a>
              </div>
              <p>argumentsUnion:
Take arguments and tranform them into options and args.
options is a union of all items in <code>arguments</code> that are objects
args is a concat of all arguments that aren&#39;t objects in the same order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">argumentsUnion</span></span> = (argList) -&gt;
  obj = {}
  list = []
  <span class="keyword">for</span> v <span class="keyword">in</span> argList
    <span class="keyword">if</span> oj.isObject v
      obj = _.extend obj, v
    <span class="keyword">else</span>
      list.push v
  options: obj, args: list</pre></div></div>
            
        </li>
        
        
        <li id="section-261">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-261">&#182;</a>
              </div>
              <h2>oj.enum</h2>

            </div>
            
        </li>
        
        
        <li id="section-262">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-262">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">enum</span></span> = (name, args) -&gt;
  <span class="keyword">throw</span> <span class="string">'NYI'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-263">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-263">&#182;</a>
              </div>
              <h2>oj.View</h2>

            </div>
            
        </li>
        
        
        <li id="section-264">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-264">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.View = oj.type <span class="string">'View'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-265">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-265">&#182;</a>
              </div>
              <p>Views are special objects map properties together. This is a union of arguments
With the remaining arguments becoming a list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (options = {}) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-266">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-266">&#182;</a>
              </div>
              <p>console.log &quot;View.constructor: &quot;, JSON.stringify arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"oj.<span class="subst">#{@typeName}</span>: constructor failed to set this.el"</span>) <span class="keyword">unless</span> oj.isDOM <span class="property">@el</span></pre></div></div>
            
        </li>
        
        
        <li id="section-267">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-267">&#182;</a>
              </div>
              <p>Set instance on @el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _setInstanceOnElement <span class="property">@el</span>, @</pre></div></div>
            
        </li>
        
        
        <li id="section-268">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-268">&#182;</a>
              </div>
              <p>Emit as a tag if new wasn&#39;t called</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@emit</span>() <span class="keyword">if</span> @.__autonew__</pre></div></div>
            
        </li>
        
        
        <li id="section-269">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-269">&#182;</a>
              </div>
              <p>Generate id if missing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options.id ?= oj.id()</pre></div></div>
            
        </li>
        
        
        <li id="section-270">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-270">&#182;</a>
              </div>
              <p>Add class oj-typeName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@$el</span>.addClass <span class="string">"oj-<span class="subst">#{@typeName}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-271">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-271">&#182;</a>
              </div>
              <p>Views automatically set all options to their properties
arguments directly to properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@set</span> options</pre></div></div>
            
        </li>
        
        
        <li id="section-272">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-272">&#182;</a>
              </div>
              <p>Remove options that were set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options = _.omit options, <span class="property">@properties</span>...</pre></div></div>
            
        </li>
        
        
        <li id="section-273">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-273">&#182;</a>
              </div>
              <p>Views pass through remaining options to be attributes on the root element
This can include jquery events and interpreted arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@addAttributes</span> options</pre></div></div>
            
        </li>
        
        
        <li id="section-274">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-274">&#182;</a>
              </div>
              <p>Record if view is fully constructed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@_isConstructed</span> = <span class="literal">true</span>

  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-275">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-275">&#182;</a>
              </div>
              <p>The element backing the View</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    el:
      get: -&gt; <span class="property">@_el</span>
      set: (v) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-276">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-276">&#182;</a>
              </div>
              <p>Set the element directly if this is a dom element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isDOMElement v
          <span class="property">@_el</span> = v</pre></div></div>
            
        </li>
        
        
        <li id="section-277">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-277">&#182;</a>
              </div>
              <p>Clear cache of $el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="property">@_$el</span> = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-278">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-278">&#182;</a>
              </div>
              <p>Generate the element from ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">else</span>
          {dom:<span class="property">@_el</span>, cssMap:<span class="property">@cssMap</span>} = oj.compile css:<span class="number">0</span>, cssMap:<span class="number">1</span>, dom:<span class="number">1</span>, html:<span class="number">0</span>, v
        <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-279">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-279">&#182;</a>
              </div>
              <p>Get and cache jquery-enabled element (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $el: get: -&gt; <span class="property">@_$el</span> ? (<span class="property">@_$el</span> = $ <span class="property">@el</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-280">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-280">&#182;</a>
              </div>
              <p>Get all attributes (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    attributes: get: -&gt;
      out = {}
      $.each <span class="property">@el</span>.attributes, (index, attr) -&gt; out[ attr.name ] = attr.value;
      out</pre></div></div>
            
        </li>
        
        
        <li id="section-281">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-281">&#182;</a>
              </div>
              <p>Get and set id of view from attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id:
      get: -&gt; <span class="property">@$el</span>.attr <span class="string">'id'</span>
      set: (v) -&gt; <span class="property">@$el</span>.attr <span class="string">'id'</span>, v</pre></div></div>
            
        </li>
        
        
        <li id="section-282">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-282">&#182;</a>
              </div>
              <p>CSS generated for this instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cssMap:
      get: -&gt; <span class="property">@_cssMap</span> ? {}
      set: (v) -&gt;
        <span class="property">@_cssMap</span> = v</pre></div></div>
            
        </li>
        
        
        <li id="section-283">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-283">&#182;</a>
              </div>
              <p>Determine if this view has been fully constructed (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isConstructed: get: -&gt; <span class="property">@_isConstructed</span> ? <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-284">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-284">&#182;</a>
              </div>
              <p>Determine if this view has been fully inserted (readonly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isInserted:
      get: -&gt; <span class="property">@_isInserted</span> ? <span class="literal">false</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-285">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-285">&#182;</a>
              </div>
              <p>Mirror backbone view&#39;s find by selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $: -&gt; <span class="property">@$el</span>.find arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-286">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-286">&#182;</a>
              </div>
              <p>Add a single attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addAttribute: (name,value) -&gt;
      attr = {}
      attr[name] = value
      <span class="property">@addAttributes</span> attr</pre></div></div>
            
        </li>
        
        
        <li id="section-287">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-287">&#182;</a>
              </div>
              <p>Add attributes and apply the oj magic with jquery binding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addAttributes: (attributes) -&gt;
      attr = _.clone attributes

      events = _attributesProcessedForOJ attr</pre></div></div>
            
        </li>
        
        
        <li id="section-288">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-288">&#182;</a>
              </div>
              <p>Add attributes as object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> oj.isObject attr
        <span class="keyword">for</span> k,v <span class="keyword">of</span> attr</pre></div></div>
            
        </li>
        
        
        <li id="section-289">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-289">&#182;</a>
              </div>
              <p>Wrap k in quotes if it has whitespace</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">if</span> k == <span class="string">'class'</span>
            <span class="property">@$el</span>.addClass v</pre></div></div>
            
        </li>
        
        
        <li id="section-290">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-290">&#182;</a>
              </div>
              <p>Boolean attributes have no value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">else</span> <span class="keyword">if</span> v == <span class="literal">true</span>
            att = document.createAttribute k
            <span class="property">@el</span>.setAttributeNode att</pre></div></div>
            
        </li>
        
        
        <li id="section-291">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-291">&#182;</a>
              </div>
              <p>Otherwise add it normally</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">else</span>
            <span class="property">@$el</span>.attr k, v</pre></div></div>
            
        </li>
        
        
        <li id="section-292">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-292">&#182;</a>
              </div>
              <p>Bind events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> events?
        _attributesBindEventsToDOM events, <span class="property">@el</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-293">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-293">&#182;</a>
              </div>
              <p>Remove a single attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeAttribute: (name) -&gt;
      <span class="property">@$el</span>.removeAttr name
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-294">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-294">&#182;</a>
              </div>
              <p>Remove multiple attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeAttributes: (list) -&gt;
      <span class="keyword">for</span> k <span class="keyword">in</span> list
        <span class="property">@removeAttribute</span> k
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-295">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-295">&#182;</a>
              </div>
              <p>emit: Emit instance as a tag function would do</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    emit: -&gt; _.argumentsAppend @; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-296">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-296">&#182;</a>
              </div>
              <p>Convert View to html</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toHTML: (options) -&gt;
      <span class="property">@el</span>.outerHTML + (<span class="keyword">if</span> options?.debug <span class="keyword">then</span> <span class="string">'\n'</span> <span class="keyword">else</span> <span class="string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-297">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-297">&#182;</a>
              </div>
              <p>Convert View to dom (for compiling)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toDOM: -&gt; <span class="property">@el</span></pre></div></div>
            
        </li>
        
        
        <li id="section-298">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-298">&#182;</a>
              </div>
              <p>Convert</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toCSS: (debug) -&gt; _cssFromObject <span class="property">@cssMap</span>, debug</pre></div></div>
            
        </li>
        
        
        <li id="section-299">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-299">&#182;</a>
              </div>
              <p>Convert</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toCSSMap: -&gt; <span class="property">@cssMap</span></pre></div></div>
            
        </li>
        
        
        <li id="section-300">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-300">&#182;</a>
              </div>
              <p>Convert View to string (for debugging)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toString: -&gt; <span class="property">@toHTML</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-301">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-301">&#182;</a>
              </div>
              <h1>Detach element from dom</h1>
<p>detach: -&gt; throw &#39;detach nyi&#39;</p>
<h1>The implementation is to set el manipulate it, and remember how to set it back</h1>
<h1>Attach element to dom where it use to be</h1>
<p>attach: -&gt; throw &#39;attach nyi&#39;</p>
<h1>The implementation is to unset el from detach</h1>
<p>inserted is called the instance is inserted in the dom (override)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    inserted: -&gt;
      <span class="property">@_isInserted</span> = <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-302">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-302">&#182;</a>
              </div>
              <h2>oj.CollectionView</h2>

            </div>
            
        </li>
        
        
        <li id="section-303">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-303">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>oj.CollectionView = oj.type <span class="string">'CollectionView'</span>,
  base: oj.View

  constructor: (options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-304">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-304">&#182;</a>
              </div>
              <p>console.log &quot;CollectionView constructor: &quot;, arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@each</span> = oj.argumentShift options, <span class="string">'each'</span> <span class="keyword">if</span> options?.each?
    <span class="property">@models</span> = oj.argumentShift options, <span class="string">'models'</span> <span class="keyword">if</span> options?.models?

    oj.CollectionView.base.constructor.apply @, arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-305">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-305">&#182;</a>
              </div>
              <p>Once everything is constructed call make precisely once.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@make</span>()

  properties:

    each:
      get: -&gt; <span class="property">@_each</span>
      set: (v) -&gt;
        <span class="property">@_each</span> = v;
        <span class="property">@make</span>() <span class="keyword">if</span> <span class="property">@isConstructed</span>
        <span class="keyword">return</span>

    models:
      get: -&gt; <span class="property">@_models</span>
      set: (v) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-306">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-306">&#182;</a>
              </div>
              <p>Unbind events if collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isFunction <span class="property">@_models</span>?.<span class="literal">off</span>
          <span class="property">@_models</span>.<span class="literal">off</span> <span class="string">'add remove change reset destroy'</span>, <span class="literal">null</span>, @

        <span class="property">@_models</span> = v</pre></div></div>
            
        </li>
        
        
        <li id="section-307">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-307">&#182;</a>
              </div>
              <p>Bind events if collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isFunction <span class="property">@_models</span>?.<span class="literal">on</span>
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'add'</span>, <span class="property">@collectionAdded</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'remove'</span>, <span class="property">@collectionRemoved</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'change'</span>, <span class="property">@collectionChanged</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'reset'</span>, <span class="property">@collectionReset</span>, @
          <span class="property">@_models</span>.<span class="literal">on</span> <span class="string">'destroy'</span>, <span class="property">@collectionDestroyed</span>, @

        <span class="property">@make</span>() <span class="keyword">if</span> <span class="property">@isConstructed</span>

        <span class="keyword">return</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-308">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-308">&#182;</a>
              </div>
              <p>Override make to create your view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    make: -&gt; <span class="keyword">throw</span> <span class="string">"oj.<span class="subst">#{typeName}</span>: make not implemented"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-309">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-309">&#182;</a>
              </div>
              <p>Override these events to minimally update on change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionAdded: (model, collection) -&gt; <span class="property">@make</span>()
    collectionRemoved: (model, collection, options) -&gt; <span class="property">@make</span>()
    collectionReset: (collection, options) -&gt; <span class="property">@make</span>()
    collectionChanged: (model, collection, options) -&gt; <span class="comment"># Do nothing</span>
    collectionDestroyed: (collection, options) -&gt; <span class="property">@make</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-310">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-310">&#182;</a>
              </div>
              <h2>oj.ModelView</h2>

            </div>
            
        </li>
        
        
        <li id="section-311">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-311">&#182;</a>
              </div>
              <p>Model view base class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.ModelView = oj.type <span class="string">'ModelView'</span>,
  base: oj.View

  constructor: (options) -&gt;

    <span class="property">@value</span> = oj.argumentShift options, <span class="string">'value'</span> <span class="keyword">if</span> options?.value?
    <span class="property">@model</span> = oj.argumentShift options, <span class="string">'model'</span> <span class="keyword">if</span> options?.model?

    oj.ModelView.base.constructor.apply @, arguments

  properties:
    model:
      get: -&gt; <span class="property">@_model</span>
      set: (v) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-312">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-312">&#182;</a>
              </div>
              <p>Unbind events on the old model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isEvent <span class="property">@_model</span>
          <span class="property">@_model</span>.<span class="literal">off</span> <span class="string">'change'</span>, <span class="literal">null</span>, @

        <span class="property">@_model</span> = v;</pre></div></div>
            
        </li>
        
        
        <li id="section-313">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-313">&#182;</a>
              </div>
              <p>Bind events on the new model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> oj.isEvent <span class="property">@_model</span>
          <span class="property">@_model</span>.<span class="literal">on</span> <span class="string">'change'</span>, <span class="property">@modelChanged</span>, @</pre></div></div>
            
        </li>
        
        
        <li id="section-314">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-314">&#182;</a>
              </div>
              <p>Trigger change manually when settings new model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@modelChanged</span>()
        <span class="keyword">return</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-315">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-315">&#182;</a>
              </div>
              <p>Override modelChanged if you don&#39;t want a full remake</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    modelChanged: -&gt;
      <span class="property">@$el</span>.oj =&gt;
        <span class="property">@make</span> <span class="property">@mode</span>

    make: (model) -&gt; <span class="keyword">throw</span> <span class="string">"oj.<span class="subst">#{@typeName}</span>: make not implemented"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-316">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-316">&#182;</a>
              </div>
              <h2>oj.ModelKeyView</h2>

            </div>
            
        </li>
        
        
        <li id="section-317">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-317">&#182;</a>
              </div>
              <p>Model key view base class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.ModelKeyView = oj.type <span class="string">'ModelKeyView'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-318">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-318">&#182;</a>
              </div>
              <p>Inherit ModelView to handle model and bindings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  base: oj.ModelView

  constructor: (options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-319">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-319">&#182;</a>
              </div>
              <p>console.log &quot;ModelKeyView.constructor: &quot;, JSON.stringify arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@key</span> = oj.argumentShift options, <span class="string">'key'</span> <span class="keyword">if</span> options?.key?</pre></div></div>
            
        </li>
        
        
        <li id="section-320">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-320">&#182;</a>
              </div>
              <p>Call super to bind model and value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.ModelKeyView.base.constructor.apply @, arguments

  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-321">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-321">&#182;</a>
              </div>
              <p>Key used to access model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    key: <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-322">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-322">&#182;</a>
              </div>
              <p>Value directly gets and sets to the dom
when it changes it must trigger viewChanged</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    value:
      get: -&gt; <span class="keyword">throw</span> <span class="string">"<span class="subst">#{@typeName}</span> value getter not implemented"</span>
      set: (v) -&gt; <span class="keyword">throw</span> <span class="string">"<span class="subst">#{@typeName}</span> value setter not implemented"</span>

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-323">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-323">&#182;</a>
              </div>
              <p>When the model changes update the value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    modelChanged: -&gt;
      <span class="keyword">if</span> <span class="property">@model</span>? <span class="keyword">and</span> <span class="property">@key</span>?</pre></div></div>
            
        </li>
        
        
        <li id="section-324">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-324">&#182;</a>
              </div>
              <p>Update the view if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@_viewUpdatedModel</span>
          <span class="property">@value</span> = <span class="property">@model</span>.get <span class="property">@key</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-325">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-325">&#182;</a>
              </div>
              <p>When the view changes update the model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    viewChanged: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-326">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-326">&#182;</a>
              </div>
              <p>Delay view changes because many of them hook before controls update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      setTimeout (=&gt;
        <span class="keyword">if</span> <span class="property">@model</span>? <span class="keyword">and</span> <span class="property">@key</span>?</pre></div></div>
            
        </li>
        
        
        <li id="section-327">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-327">&#182;</a>
              </div>
              <p>Ensure view changes aren&#39;t triggered twice</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="property">@_viewUpdatedModel</span> = <span class="literal">true</span>
          <span class="property">@model</span>.set <span class="property">@key</span>, <span class="property">@value</span>
          <span class="property">@_viewUpdatedModel</span> = <span class="literal">false</span>
        <span class="keyword">return</span>
        ), <span class="number">10</span>
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-328">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-328">&#182;</a>
              </div>
              <h2>oj.TextBox</h2>

            </div>
            
        </li>
        
        
        <li id="section-329">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-329">&#182;</a>
              </div>
              <p>TextBox control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.TextBox = oj.type <span class="string">'TextBox'</span>,

  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.argumentsUnion arguments

    <span class="property">@el</span> = oj =&gt;
      oj.input type:<span class="string">'text'</span>,
        keydown: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        keyup: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-330">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-330">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-331">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-331">&#182;</a>
              </div>
              <p>Set live if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@live</span> = oj.argumentShift options, <span class="string">'live'</span> <span class="keyword">if</span> options?.live?

    oj.TextBox.base.constructor.apply @, [options]

  properties:
    value:
      get: -&gt;
        v = <span class="property">@el</span>.value
        v = <span class="string">''</span> <span class="keyword">if</span> <span class="keyword">not</span> v? <span class="keyword">or</span> v == <span class="string">'undefined'</span>
        v
      set: (v) -&gt;
        <span class="property">@el</span>.value = v; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-332">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-332">&#182;</a>
              </div>
              <p>Live update model as text changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    live: <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-333">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-333">&#182;</a>
              </div>
              <h2>oj.CheckBox</h2>

            </div>
            
        </li>
        
        
        <li id="section-334">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-334">&#182;</a>
              </div>
              <p>CheckBox control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.CheckBox = oj.type <span class="string">'CheckBox'</span>,
  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.argumentsUnion arguments

    <span class="property">@el</span> = oj =&gt;
      oj.input type:<span class="string">'checkbox'</span>,
        change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-335">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-335">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span>

    oj.CheckBox.base.constructor.call @, options

  properties:
    value:
      get: -&gt; <span class="property">@el</span>.checked
      set: (v) -&gt;
        v = !!v
        <span class="property">@el</span>.checked = v
        <span class="keyword">if</span> v
          <span class="property">@$el</span>.attr <span class="string">'checked'</span>, <span class="string">'checked'</span>
        <span class="keyword">else</span>
          <span class="property">@$el</span>.removeAttr <span class="string">'checked'</span>
        <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-336">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-336">&#182;</a>
              </div>
              <h2>oj.TextArea</h2>

            </div>
            
        </li>
        
        
        <li id="section-337">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-337">&#182;</a>
              </div>
              <p>TextArea control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.TextArea = oj.type <span class="string">'TextArea'</span>,
  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.argumentsUnion arguments

    <span class="property">@el</span> = oj =&gt;
      oj.textarea
        keydown: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        keyup: =&gt; <span class="keyword">if</span> <span class="property">@live</span> <span class="keyword">then</span> <span class="property">@viewChanged</span>(); <span class="keyword">return</span>
        change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-338">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-338">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span>

    oj.TextArea.base.constructor.call @, options

  properties:
    value:
      get: -&gt; <span class="property">@el</span>.value
      set: (v) -&gt; <span class="property">@el</span>.value = v; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-339">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-339">&#182;</a>
              </div>
              <p>Live update model as text changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    live: <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-340">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-340">&#182;</a>
              </div>
              <h2>oj.ListBox</h2>

            </div>
            
        </li>
        
        
        <li id="section-341">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-341">&#182;</a>
              </div>
              <p>ListBox control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.ListBox = oj.type <span class="string">'ListBox'</span>,
  base: oj.ModelKeyView

  constructor: -&gt;
    {options, args} = oj.argumentsUnion arguments

    <span class="property">@el</span> = oj =&gt;
      oj.select change: =&gt; <span class="property">@viewChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-342">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-342">&#182;</a>
              </div>
              <p>@options is a list of elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@options</span> = oj.argumentShift options, <span class="string">'options'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-343">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-343">&#182;</a>
              </div>
              <p>Value can be set by argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@value</span> = args[<span class="number">0</span>] <span class="keyword">if</span> args.length &gt; <span class="number">0</span>

    oj.ListBox.base.constructor.apply @, [options]

  properties:
    value:
      get: -&gt; <span class="property">@$el</span>.val()
      set: (v) -&gt; <span class="property">@$el</span>.val(v); <span class="keyword">return</span>

    options:
      get: -&gt; <span class="property">@_options</span>
      set: (v) -&gt;
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.ListBox::options array is missing'</span>) <span class="keyword">unless</span> oj.isArray v
        <span class="property">@_options</span> = v
        <span class="property">@$el</span>.oj -&gt;
          <span class="keyword">for</span> op <span class="keyword">in</span> v
            oj.option op
          <span class="keyword">return</span>
        <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-344">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-344">&#182;</a>
              </div>
              <h2>oj.Button</h2>

            </div>
            
        </li>
        
        
        <li id="section-345">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-345">&#182;</a>
              </div>
              <p>Button control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.Button = oj.type <span class="string">'Button'</span>,
  base: oj.View

  constructor: (args) -&gt;
    {options, args} = oj.argumentsUnion arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-346">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-346">&#182;</a>
              </div>
              <p>Label is first argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options.label ?= <span class="keyword">if</span> args.length &gt; <span class="number">0</span> <span class="keyword">then</span> args[<span class="number">0</span>] <span class="keyword">else</span> <span class="string">''</span>

    <span class="property">@el</span> = oj =&gt;
      oj.button options.label

    oj.Button.base.constructor.apply @, [options]</pre></div></div>
            
        </li>
        
        
        <li id="section-347">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-347">&#182;</a>
              </div>
              <h2>oj.Link</h2>

            </div>
            
        </li>
        
        
        <li id="section-348">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-348">&#182;</a>
              </div>
              <p>oj.Link = class Link inherits Control</p>
<h2>oj.List</h2>

            </div>
            
        </li>
        
        
        <li id="section-349">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-349">&#182;</a>
              </div>
              <p>_boundOrThrow: Determine if the index is in range after negative correction
When out of bounds an error message is thrown</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">_boundOrThrow</span></span> = (ix, count, message) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-350">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-350">&#182;</a>
              </div>
              <p>Correct negative indexes to be in range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ixNew = <span class="keyword">if</span> ix &lt; <span class="number">0</span> <span class="keyword">then</span> ix + count <span class="keyword">else</span> ix
  <span class="keyword">unless</span> <span class="number">0</span> &lt;= ixNew <span class="keyword">and</span> ixNew &lt; count
    <span class="keyword">throw</span> <span class="keyword">new</span> Error(message + <span class="string">" is out of bounds (<span class="subst">#{ix}</span> in [0,<span class="subst">#{count-<span class="number">1</span>}</span>])"</span>)
  ixNew

oj.List = oj.type <span class="string">'List'</span>,
  base: oj.CollectionView

  constructor: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-351">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-351">&#182;</a>
              </div>
              <p>console.log &quot;List constructor: &quot;, arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    {options, args} = oj.argumentsUnion arguments</pre></div></div>
            
        </li>
        
        
        <li id="section-352">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-352">&#182;</a>
              </div>
              <p>tagName is write-once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@_tagName</span> = oj.argumentShift options, <span class="string">'tagName'</span>

    <span class="property">@itemTagName</span> = oj.argumentShift options, <span class="string">'itemTagName'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-353">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-353">&#182;</a>
              </div>
              <p>Generate el</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@el</span> = oj =&gt;
      oj[<span class="property">@tagName</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-354">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-354">&#182;</a>
              </div>
              <p>Use el if it was passed in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@el</span> = oj.argumentShift(options, <span class="string">'el'</span>) <span class="keyword">if</span> options.el?</pre></div></div>
            
        </li>
        
        
        <li id="section-355">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-355">&#182;</a>
              </div>
              <p>Default @each function to pass through values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options.each ?= (model) -&gt;
      <span class="keyword">if</span> (oj.isString model) <span class="keyword">or</span> (oj.isNumber model) <span class="keyword">or</span> (oj.isBoolean model)
        model
      <span class="keyword">else</span>
        JSON.stringify model</pre></div></div>
            
        </li>
        
        
        <li id="section-356">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-356">&#182;</a>
              </div>
              <p>Args have been handled so don&#39;t pass them on</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.List.base.constructor.apply @, [options]</pre></div></div>
            
        </li>
        
        
        <li id="section-357">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-357">&#182;</a>
              </div>
              <p>Set @items to options or args if they exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    items = <span class="keyword">if</span> args.length &gt; <span class="number">0</span> <span class="keyword">then</span> args <span class="keyword">else</span> <span class="literal">null</span>
    <span class="property">@items</span> = <span class="keyword">if</span> options.items? <span class="keyword">then</span> (oj.argumentShift options, <span class="string">'items'</span>) <span class="keyword">else</span> items

  properties:</pre></div></div>
            
        </li>
        
        
        <li id="section-358">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-358">&#182;</a>
              </div>
              <p>items: get or set all items at once (readwrite)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    items:</pre></div></div>
            
        </li>
        
        
        <li id="section-359">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-359">&#182;</a>
              </div>
              <p>Used cached items or items as interpreted by ojValue jquery plugin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      get: -&gt;
        <span class="keyword">return</span> <span class="property">@_items</span> <span class="keyword">if</span> <span class="property">@_items</span>?
        v = <span class="property">@$itemsEl</span>.ojValue()
        <span class="keyword">if</span> oj.isArray v <span class="keyword">then</span> v <span class="keyword">else</span> [v]

      set: (v) -&gt; <span class="property">@_items</span> = v; <span class="property">@make</span>(); <span class="keyword">return</span>

    count: get: -&gt; <span class="property">@$itemsEl</span>.length</pre></div></div>
            
        </li>
        
        
        <li id="section-360">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-360">&#182;</a>
              </div>
              <p>tagName: name of root tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tagName: get: -&gt; <span class="property">@_tagName</span> ? <span class="string">'div'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-361">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-361">&#182;</a>
              </div>
              <p>itemTagName: name of item tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    itemTagName:
      get: -&gt; <span class="property">@_itemTagName</span> ? <span class="string">'div'</span>
      set: (v) -&gt; <span class="property">@_itemTagName</span> = v; <span class="property">@make</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-362">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-362">&#182;</a>
              </div>
              <p>itemsEl: list of elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    itemsEl: get: -&gt; <span class="property">@$itemsEl</span>.get()</pre></div></div>
            
        </li>
        
        
        <li id="section-363">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-363">&#182;</a>
              </div>
              <p>$itemsEl: list of jquery elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $itemsEl: get: -&gt; <span class="property">@_$itemsEl</span> ? (<span class="property">@_$itemsEl</span> = <span class="property">@$</span>(<span class="string">"&gt; <span class="subst">#{@itemTagName}</span>"</span>))

  methods:</pre></div></div>
            
        </li>
        
        
        <li id="section-364">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-364">&#182;</a>
              </div>
              <p>Get item value at index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    item: (ix, ojml) -&gt;
      ix = _boundOrThrow ix, <span class="property">@count</span>, <span class="string">"oj.List.item: index"</span>
      <span class="keyword">if</span> ojml?
        <span class="property">@$itemEl</span>(ix).oj ojml
        <span class="keyword">return</span>
      <span class="keyword">else</span>
        <span class="property">@$itemEl</span>(ix).ojValue()</pre></div></div>
            
        </li>
        
        
        <li id="section-365">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-365">&#182;</a>
              </div>
              <p>Get item element at index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    itemEl: (ix) -&gt;
      ix = _boundOrThrow ix, <span class="property">@count</span>, <span class="string">"oj.List.itemEl: index"</span>
      <span class="property">@$itemsEl</span>[ix]</pre></div></div>
            
        </li>
        
        
        <li id="section-366">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-366">&#182;</a>
              </div>
              <p>Get item jquery element at index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $itemEl: (ix) -&gt;
      ix = _boundOrThrow ix, <span class="property">@count</span>, <span class="string">"oj.List.$itemEl: index"</span>
      <span class="property">@$itemsEl</span>.eq(ix)</pre></div></div>
            
        </li>
        
        
        <li id="section-367">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-367">&#182;</a>
              </div>
              <p>Remake everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    make: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-368">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-368">&#182;</a>
              </div>
              <p>Some properties call make before construction completes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@isConstructed</span></pre></div></div>
            
        </li>
        
        
        <li id="section-369">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-369">&#182;</a>
              </div>
              <p>Convert models to views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      views = []
      <span class="keyword">if</span> <span class="property">@models</span>? <span class="keyword">and</span> <span class="property">@each</span>?
        models = <span class="keyword">if</span> oj.isEvent <span class="property">@_models</span> <span class="keyword">then</span> <span class="property">@_models</span>.models <span class="keyword">else</span> <span class="property">@_models</span>
        <span class="keyword">for</span> model <span class="keyword">in</span> models
          views.push <span class="property">@_itemFromModel</span> model</pre></div></div>
            
        </li>
        
        
        <li id="section-370">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-370">&#182;</a>
              </div>
              <p>Items are already views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span> <span class="keyword">if</span> <span class="property">@items</span>?
        views = <span class="property">@items</span></pre></div></div>
            
        </li>
        
        
        <li id="section-371">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-371">&#182;</a>
              </div>
              <p>Render the views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="property">@$el</span>.oj =&gt;
        <span class="keyword">for</span> view <span class="keyword">in</span> views
          <span class="property">@_itemElFromItem</span> view

      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-372">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-372">&#182;</a>
              </div>
              <p>Helper to map model to item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _itemFromModel: (model) -&gt;
      oj =&gt;
        <span class="property">@each</span> model</pre></div></div>
            
        </li>
        
        
        <li id="section-373">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-373">&#182;</a>
              </div>
              <p>Helper to create itemTagName wrapped item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _itemElFromItem: (item) -&gt;
      oj[<span class="property">@itemTagName</span>] item

    add: (ix, ojml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-374">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-374">&#182;</a>
              </div>
              <p>Default to adding at the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> arguments.length == <span class="number">1</span>
        ojml = ix
        ix = <span class="property">@count</span>

      ix = _boundOrThrow ix, <span class="property">@count</span>+<span class="number">1</span>, <span class="string">"oj.List.add: index"</span>

      tag = <span class="property">@itemTagName</span></pre></div></div>
            
        </li>
        
        
        <li id="section-375">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-375">&#182;</a>
              </div>
              <p>Empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> <span class="property">@count</span> == <span class="number">0</span>
        <span class="property">@$el</span>.oj -&gt; oj[tag] ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-376">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-376">&#182;</a>
              </div>
              <p>Last</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span> <span class="keyword">if</span> ix == <span class="property">@count</span>
        <span class="property">@$itemEl</span>(ix-<span class="number">1</span>).ojAfter -&gt; oj[tag] ojml</pre></div></div>
            
        </li>
        
        
        <li id="section-377">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-377">&#182;</a>
              </div>
              <p>Not last</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span>
        <span class="property">@$itemEl</span>(ix).ojBefore -&gt; oj[tag] ojml

      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span>

    remove: (ix = -<span class="number">1</span>) -&gt;
      ix = _boundOrThrow ix, <span class="property">@count</span>, <span class="string">"oj.List.remove: index"</span>
      out = <span class="property">@item</span> ix
      <span class="property">@$itemEl</span>(ix).remove()
      <span class="property">@itemsChanged</span>()
      out

    move: (ixFrom, ixTo = -<span class="number">1</span>) -&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> ixFrom == ixTo

      ixFrom = _boundOrThrow ixFrom, <span class="property">@count</span>, <span class="string">"oj.List.move: fromIndex"</span>
      ixTo = _boundOrThrow ixTo, <span class="property">@count</span>, <span class="string">"oj.List.move: toIndex"</span>

      <span class="keyword">if</span> ixTo &gt; ixFrom
        <span class="property">@$itemEl</span>(ixFrom).insertAfter <span class="property">@$itemEl</span>(ixTo)
      <span class="keyword">else</span>
        <span class="property">@$itemEl</span>(ixFrom).insertBefore <span class="property">@$itemEl</span>(ixTo)

      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span>

    swap: (ix1, ix2) -&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> ix1 == ix2

      ix1 = _boundOrThrow ix1, <span class="property">@count</span>, <span class="string">"oj.List.swap: firstIndex"</span>
      ix2 = _boundOrThrow ix2, <span class="property">@count</span>, <span class="string">"oj.List.swap: secondIndex"</span>

      <span class="keyword">if</span> Math.abs(ix1-ix2) == <span class="number">1</span>
        <span class="property">@move</span> ix1, ix2
      <span class="keyword">else</span>
        ixMin = Math.min ix1, ix2
        ixMax = Math.max ix1, ix2
        <span class="property">@move</span> ixMax, ixMin
        <span class="property">@move</span> ixMin+<span class="number">1</span>, ixMax
      <span class="property">@itemsChanged</span>()
      <span class="keyword">return</span>

    unshift: (v) -&gt; <span class="property">@add</span> <span class="number">0</span>, v; <span class="keyword">return</span>

    shift: -&gt; <span class="property">@remove</span> <span class="number">0</span>

    push: (v) -&gt; <span class="property">@add</span>(v); <span class="keyword">return</span>

    pop: -&gt; <span class="property">@remove</span> -<span class="number">1</span>

    clear: -&gt; <span class="property">@$itemsEl</span>.remove(); <span class="property">@itemsChanged</span>(); <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-378">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-378">&#182;</a>
              </div>
              <p>When items change clear relevant cached values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    itemsChanged: -&gt; <span class="property">@_$itemsEl</span> = <span class="literal">null</span>; <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-379">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-379">&#182;</a>
              </div>
              <h1>On add minimally create the missing model</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionAdded: (m, c) -&gt;
      ix = c.indexOf m
      item = <span class="property">@_itemFromModel</span> m
      <span class="property">@add</span> ix, item
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-380">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-380">&#182;</a>
              </div>
              <p>On add minimally create the missing model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    collectionRemoved: (m, c, o) -&gt;
      <span class="property">@remove</span> o.index
      <span class="keyword">return</span>

    collectionReset: -&gt;
      <span class="property">@make</span>()
      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-381">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-381">&#182;</a>
              </div>
              <h2>oj.NumberList</h2>

            </div>
            
        </li>
        
        
        <li id="section-382">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-382">&#182;</a>
              </div>
              <p>NumberList is a <code>List</code> specialized with <code>&lt;ol&gt;</code> and <code>&lt;li&gt;</code> tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">NumberList</span></span> = -&gt;
  oj.List.call @, {tagName:<span class="string">'ol'</span>, itemTagName:<span class="string">'li'</span>}, arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-383">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-383">&#182;</a>
              </div>
              <h2>oj.BulletList</h2>

            </div>
            
        </li>
        
        
        <li id="section-384">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-384">&#182;</a>
              </div>
              <p>BulletList is a <code>List</code> specialized with <code>&lt;ul&gt;</code> and <code>&lt;li&gt;</code> tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">BulletList</span></span> = -&gt;
  oj.List.call @, {tagName:<span class="string">'ul'</span>, itemTagName:<span class="string">'li'</span>}, arguments...</pre></div></div>
            
        </li>
        
        
        <li id="section-385">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-385">&#182;</a>
              </div>
              <h2>oj.Table</h2>

            </div>
            
        </li>
        
        
        <li id="section-386">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-386">&#182;</a>
              </div>
              <p>oj.Table = oj.type &#39;Table&#39;,
  base: oj.CollectionView</p>
<p>  properties:
    rows: (list) -&gt;
    rowCount: -&gt;
    cellCount: -&gt;</p>
<p>  methods:
    row: (r) -&gt;
    cell: (r, c) -&gt;</p>
<p>oj.Table.Row = oj.type &#39;Table.Row&#39;,
  base: oj.ModelView
  properties:
    row:
      get: -&gt;
      set: (list) -&gt;
  methods:
    cell: -&gt;</p>
<h2>oj.sandbox</h2>

            </div>
            
        </li>
        
        
        <li id="section-387">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-387">&#182;</a>
              </div>
              <p>The sandbox is a readonly version of oj that is exposed to the user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.sandbox = {}
<span class="keyword">for</span> key <span class="keyword">in</span> _.keys oj
  <span class="keyword">if</span> key.length &gt; <span class="number">0</span> <span class="keyword">and</span> key[<span class="number">0</span>] != <span class="string">'_'</span>
    oj.addProperty oj.sandbox, key, value:oj[key], writable:<span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-388">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-388">&#182;</a>
              </div>
              <h2>oj.use(plugin, settings)</h2>

            </div>
            
        </li>
        
        
        <li id="section-389">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-389">&#182;</a>
              </div>
              <p>Include a plugin of OJ with <code>settings</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>oj.<span class="function"><span class="title">use</span></span> = (plugin, settings = {}) -&gt;
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.use: function expected for first argument'</span>) <span class="keyword">unless</span> oj.isFunction plugin
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'oj.use: object expected for second argument'</span>) <span class="keyword">unless</span> oj.isObject settings</pre></div></div>
            
        </li>
        
        
        <li id="section-390">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-390">&#182;</a>
              </div>
              <p>Call plugin to gather extension map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pluginMap = plugin oj, settings</pre></div></div>
            
        </li>
        
        
        <li id="section-391">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-391">&#182;</a>
              </div>
              <p>Extend all properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">for</span> name,value <span class="keyword">of</span> pluginMap
    oj[name] = value</pre></div></div>
            
        </li>
        
        
        <li id="section-392">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-392">&#182;</a>
              </div>
              <p>Add to sandbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oj.addProperty oj.sandbox, name, value:value, writable: <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-393">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-393">&#182;</a>
              </div>
              <h2>jqueryExtend(fn)</h2>

            </div>
            
        </li>
        
        
        <li id="section-394">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-394">&#182;</a>
              </div>
              <pre><code>$.fn.myExtension = jqueryExtend (($el,args) -&gt;
  $el     # =&gt; The jquery matched element
  args    # =&gt; Array of arguments
  return a non-null value to stop iteration and return value to caller
 ), (($el) -&gt;
 ), isMap</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">jqueryExtend</span></span> = (options = {}) -&gt;
  _.defaults options, get:_.identity, set:_.identity
  -&gt;
    args = _.toArray arguments
    $els = jQuery(@)</pre></div></div>
            
        </li>
        
        
        <li id="section-395">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-395">&#182;</a>
              </div>
              <p>Map over jquery selection if no arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (oj.isFunction options.get) <span class="keyword">and</span> args.length == <span class="number">0</span>
      out = []
      <span class="keyword">for</span> el <span class="keyword">in</span> $els
        out.push options.get $(el)</pre></div></div>
            
        </li>
        
        
        <li id="section-396">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-396">&#182;</a>
              </div>
              <p>Unwrap arrays of length one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> out.length == <span class="number">1</span>
        <span class="keyword">return</span> out[<span class="number">0</span>]
      out

    <span class="keyword">else</span> <span class="keyword">if</span> (oj.isFunction options.set)</pre></div></div>
            
        </li>
        
        
        <li id="section-397">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-397">&#182;</a>
              </div>
              <p>By default return this for chaining</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      out = $els
      <span class="keyword">for</span> el <span class="keyword">in</span> $els
        r = options.set $(el), args</pre></div></div>
            
        </li>
        
        
        <li id="section-398">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-398">&#182;</a>
              </div>
              <p>Short circuit if anything is returned</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> r <span class="keyword">if</span> r?

      $els</pre></div></div>
            
        </li>
        
        
        <li id="section-399">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-399">&#182;</a>
              </div>
              <h2>  jquery.oj</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>jQuery.fn.oj = jqueryExtend
  set:($el, args) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-400">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-400">&#182;</a>
              </div>
              <p>No arguments return the first instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> args.length == <span class="number">0</span>
      <span class="keyword">return</span> $el[<span class="number">0</span>].oj</pre></div></div>
            
        </li>
        
        
        <li id="section-401">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-401">&#182;</a>
              </div>
              <p>Compile ojml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    {dom,types} = oj.compile {dom:<span class="number">1</span>,html:<span class="number">0</span>,css:<span class="number">0</span>}, args...</pre></div></div>
            
        </li>
        
        
        <li id="section-402">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-402">&#182;</a>
              </div>
              <p>Reset content and append to dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $el.html <span class="string">''</span>
    dom = [dom] <span class="keyword">unless</span> oj.isArray dom
    <span class="keyword">for</span> d <span class="keyword">in</span> dom
      $el.append d</pre></div></div>
            
        </li>
        
        
        <li id="section-403">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-403">&#182;</a>
              </div>
              <p>Call inserted event on all types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> t <span class="keyword">in</span> types
      t.inserted()

    <span class="keyword">return</span>

  get: ($el) -&gt;
    $el[<span class="number">0</span>].oj</pre></div></div>
            
        </li>
        
        
        <li id="section-404">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-404">&#182;</a>
              </div>
              <h2>jquery.ojValue</h2>

            </div>
            
        </li>
        
        
        <li id="section-405">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-405">&#182;</a>
              </div>
              <p>Get the value of the selected element&#39;s contents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>jQuery.fn.ojValue = jqueryExtend
  set: <span class="literal">null</span>
  get: ($el, args) -&gt;

    el = $el[<span class="number">0</span>]
    child = el.firstChild

    <span class="keyword">switch</span> oj.typeOf child</pre></div></div>
            
        </li>
        
        
        <li id="section-406">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-406">&#182;</a>
              </div>
              <p>Parse the text to turn it into bool, number, or string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">when</span> <span class="string">'dom-text'</span>
        text = child.nodeValue</pre></div></div>
            
        </li>
        
        
        <li id="section-407">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-407">&#182;</a>
              </div>
              <p>Get elements as oj instances or elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">when</span> <span class="string">'dom-element'</span>
        <span class="keyword">if</span> (inst = _getInstanceOnElement child)?
          inst
        <span class="keyword">else</span>
          child</pre></div></div>
            
        </li>
        
        
        <li id="section-408">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-408">&#182;</a>
              </div>
              <h2>jquery.ojAfter, jquery.ojBefore, ...</h2>

            </div>
            
        </li>
        
        
        <li id="section-409">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-409">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>plugins =
  ojAfter: <span class="string">'after'</span>
  ojBefore: <span class="string">'before'</span>
  ojAppend: <span class="string">'append'</span>
  ojPrepend: <span class="string">'prepend'</span>
  ojReplaceWith: <span class="string">'replaceWith'</span>
  ojWrap: <span class="string">'wrap'</span>
  ojWrapInner: <span class="string">'wrapInner'</span>

<span class="keyword">for</span> ojName,jqName <span class="keyword">of</span> plugins
  <span class="keyword">do</span> (ojName, jqName) -&gt;
    jQuery.fn[ojName] = jqueryExtend
      set: ($el, args) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-410">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-410">&#182;</a>
              </div>
              <p>Compile ojml for each one to separate references</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        {dom,types} = oj.compile {dom:<span class="number">1</span>,html:<span class="number">0</span>}, args...</pre></div></div>
            
        </li>
        
        
        <li id="section-411">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-411">&#182;</a>
              </div>
              <p>Append to the dom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $el[jqName] dom

        <span class="keyword">for</span> t <span class="keyword">in</span> types
          t.inserted()

        <span class="keyword">return</span>

      get:<span class="literal">null</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
