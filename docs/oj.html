<!DOCTYPE html><html lang="en"><head><title>oj</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="oj"><meta name="groc-project-path" content="src/oj.coffee"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/oj.coffee</div></div><div id="document"><div class="segment"></div><div class="segment"><div class="comments"><div class="wrapper"><h1 id="oj">oj</h1>

<p>Templating framework for the people. Thirsty people.</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj = </span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span>
<span class="nv">oj.version = </span><span class="s">&#39;0.0.0&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="utility-helpers">Utility: Helpers</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Methods borrowed from <a href="http://underscorejs.org/">underscore.js</a></p></div></div><div class="code"><div class="wrapper"><span class="nv">oj._ = _ = </span><span class="p">{}</span>
<span class="nv">_.isUndefined = </span><span class="nf">(obj) -&gt;</span> <span class="nx">obj</span> <span class="o">==</span> <span class="kc">undefined</span>
<span class="nv">_.isBoolean = </span><span class="nf">(obj) -&gt;</span> <span class="nx">obj</span> <span class="o">==</span> <span class="kc">true</span> <span class="o">or</span> <span class="nx">obj</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">or</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;[object Boolean]&#39;</span>
<span class="nv">_.isNumber = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">or</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">toExponential</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">))</span>
<span class="nv">_.isString = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="o">or</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">charCodeAt</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">substr</span><span class="p">))</span>
<span class="nv">_.isDate = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getTimezoneOffset</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">setUTCFullYear</span><span class="p">)</span>
<span class="nv">_.isRegExp = </span><span class="nf">(obj) -&gt;</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;[object RegExp]&#39;</span>
<span class="nv">_.isFunction = </span><span class="nf">(obj) -&gt;</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">==</span> <span class="s">&#39;function&#39;</span>
<span class="nv">_.isArray = </span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span> <span class="o">or</span> <span class="nf">(obj) -&gt;</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;[object Array]&#39;</span>
<span class="nv">_.isElement = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="nv">_.has = </span><span class="nf">(obj, key) -&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
<span class="nv">_.keys = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span> <span class="o">||</span> <span class="nf">(obj) -&gt;</span>
  <span class="k">throw</span> <span class="s">&#39;Invalid object&#39;</span> <span class="k">if</span> <span class="nx">obj</span> <span class="o">!=</span> <span class="nb">Object</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
  <span class="nv">keys = </span><span class="p">[];</span>
  <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">obj</span>
    <span class="k">if</span> <span class="nx">_has</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span>
      <span class="nx">keys</span><span class="p">[</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
  <span class="nx">keys</span>
<span class="nv">_.values = </span><span class="nf">(obj) -&gt;</span>
  <span class="k">throw</span> <span class="s">&#39;Invalid object&#39;</span> <span class="k">if</span> <span class="nx">obj</span> <span class="o">!=</span> <span class="nb">Object</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
  <span class="nv">out = </span><span class="p">[]</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">obj</span><span class="p">,</span> <span class="nf">(v) -&gt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">push</span> <span class="nx">v</span>
  <span class="nx">out</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="utility-type-detection">Utility: Type Detection</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.isjQuery</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isjQuery = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">jquery</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.isBackbone</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isBackbone = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="kc">on</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isOJ</span> <span class="nx">obj</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.isOJ
Determine if obj is an OJ instance</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isOJ = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">ojtype</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Determine if obj is OJML instance</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isOJML = </span><span class="nf">(obj) -&gt;</span> <span class="o">!!</span><span class="p">(</span><span class="nx">obj</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">oj</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>typeOf: Mimic behavior of built-in typeof operator and integrate jQuery, Backbone, and OJ types</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.typeOf = </span><span class="nf">(any) -&gt;</span>

  <span class="k">return</span> <span class="s">&#39;null&#39;</span> <span class="k">if</span> <span class="nx">any</span> <span class="o">==</span> <span class="kc">null</span>
  <span class="nv">t = </span><span class="k">typeof</span> <span class="nx">any</span>
  <span class="k">if</span> <span class="nx">t</span> <span class="o">==</span> <span class="s">&#39;object&#39;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">any</span>           <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;array&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isRegExp</span> <span class="nx">any</span>     <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;regexp&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isDate</span> <span class="nx">any</span>       <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;date&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isBackbone</span> <span class="nx">any</span>   <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;backbone&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isjQuery</span> <span class="nx">any</span>     <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;jquery&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isOJML</span> <span class="nx">any</span>       <span class="k">then</span> <span class="nv">t = </span><span class="s">&#39;ojml&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isOJ</span> <span class="nx">any</span>         <span class="k">then</span> <span class="nv">t = </span><span class="nx">any</span><span class="p">.</span><span class="nx">ojtype</span>
    <span class="k">else</span>                       <span class="nv">t = </span><span class="s">&#39;object&#39;</span>
  <span class="nx">t</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Determine if obj is a vanilla object</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.isObject = </span><span class="nf">(obj) -&gt;</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">typeOf</span> <span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;object&#39;</span>

<span class="nv">_.clone = </span><span class="nf">(obj) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>TODO: support cloning OJ instances
TODO: support options, deep: true</p></div></div><div class="code"><div class="wrapper">  <span class="k">return</span> <span class="nx">obj</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">obj</span>
  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">obj</span> <span class="k">then</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">slice</span><span class="p">()</span> <span class="k">else</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>oj.create 'name',
  methods:
  properties:
  events:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="utility-iteration">Utility: Iteration</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_each(collection, iterator, context)</p>

<pre><code>Iterate over collection or function. If a function
is encountered it is evaluated before iteration

collection    Array or Object to iterate over
iterator      Function to call on each step
context       (Optional) Object to pass as 'this' to iteration method
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">_.breaker = </span><span class="p">{}</span>
<span class="nv">_.each = </span><span class="nf">(col, iterator, context) -&gt;</span>

  <span class="k">return</span> <span class="k">if</span> <span class="nx">col</span> <span class="o">==</span> <span class="kc">null</span>
  <span class="k">if</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">and</span> <span class="nx">col</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">==</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span>
    <span class="nx">col</span><span class="p">.</span><span class="nx">forEach</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">context</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">col</span>
    <span class="k">for</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">col</span>
      <span class="k">if</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">col</span><span class="p">)</span> <span class="o">==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span>
  <span class="k">else</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">col</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">k</span>
        <span class="k">if</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">col</span><span class="p">)</span> <span class="o">==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span>
          <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">breaker</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.map(collection, iterator, options = {})</p>

<pre><code>Map over object or array If a function
is encountered it is evaluated before iteration

collection    Array or Object to iterate over
iterator      Function to call on each step
options
  context       (Optional) Object to pass as 'this' to iteration method
  context       (Optional) Boolean indicating  to pass as 'this' to iteration method
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">_.map = </span><span class="nf">(obj, iterator, options = {}) -&gt;</span>

  <span class="nv">context = </span><span class="nx">options</span><span class="p">.</span><span class="nx">context</span>
  <span class="nv">recurse = </span><span class="nx">options</span><span class="p">.</span><span class="nx">recurse</span>
  <span class="nv">evaluate = </span><span class="nx">options</span><span class="p">.</span><span class="nx">evaluate</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Recurse if necessary</p></div></div><div class="code"><div class="wrapper">  <span class="nv">iterator_ = </span><span class="nx">iterator</span>
  <span class="k">if</span> <span class="nx">recurse</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;map2 option.recurse is true&#39;</span>
    <span class="nx">do</span> <span class="nf">(options) -&gt;</span>
      <span class="nv">options_ = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">options</span>
      <span class="nv">iterator_ = </span><span class="nf">(v,k,o) -&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;iterator_ called with v: &#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="s">&#39; k: &#39;</span><span class="p">,</span> <span class="nx">k</span>
        <span class="nv">options__ = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">options_</span><span class="p">),</span> <span class="p">(</span><span class="nv">key: </span><span class="nx">k</span><span class="p">,</span> <span class="nv">object: </span><span class="nx">v</span><span class="p">)</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">options__</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Evaluate functions if necessary</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Functions pass through if evaluate isn't set</p></div></div><div class="code"><div class="wrapper">    <span class="k">return</span> <span class="nx">obj</span> <span class="nx">unless</span> <span class="nx">evaluate</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;map2 found a function&#39;</span>
    <span class="k">while</span> <span class="nx">evaluate</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">obj</span>
      <span class="nv">obj = </span><span class="nx">obj</span><span class="p">()</span>

  <span class="nv">out = </span><span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Array case</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">obj</span>
    <span class="nv">out = </span><span class="p">[]</span>
    <span class="k">return</span> <span class="nx">out</span> <span class="nx">unless</span> <span class="nx">obj</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">map</span> <span class="nx">iterator_</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="k">if</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">map</span> <span class="o">and</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">map</span> <span class="o">==</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">map</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;map found array&#39;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="p">(</span><span class="nf">(v, ix, list) -&gt;</span>
      <span class="nx">out</span><span class="p">[</span><span class="nx">out</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">iterator_</span><span class="p">.</span><span class="nx">call</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">ix</span><span class="p">,</span> <span class="nx">list</span>
    <span class="p">))</span>

    <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">out.length = </span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Object case</p></div></div><div class="code"><div class="wrapper">  <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">obj</span>
    <span class="nv">out = </span><span class="p">{}</span>
    <span class="k">return</span> <span class="nx">out</span> <span class="nx">unless</span> <span class="nx">obj</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Returning undefined will omit the thing</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span><span class="nv">r = </span><span class="nx">iterator_</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">obj</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">undefined</span>
        <span class="nx">out</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Basis of recursive case</p></div></div><div class="code"><div class="wrapper">  <span class="k">else</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;map2 found value: &#39;</span><span class="p">,</span> <span class="nx">obj</span>
    <span class="k">return</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span>
  <span class="nx">out</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.extend</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.extend = </span><span class="nf">(obj) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="nf">(source) -&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">source</span>
      <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="p">))</span>
  <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.defaults</p></div></div><div class="code"><div class="wrapper"><span class="nv">_.defaults = </span><span class="nf">(obj) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="nf">(source) -&gt;</span>
    <span class="k">for</span> <span class="nx">prop</span> <span class="k">of</span> <span class="nx">source</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span><span class="o">?</span>
        <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
  <span class="p">))</span>
  <span class="nx">obj</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.eachEvaluate(collection, iterator, context)</p>

<pre><code>Iterate over collection. If a function is encountered evaulate it before iterating.

collection    Array, Object, or Function to iterate over
iterator      Function to call on each step
context       (Optional) Object to pass as 'this' to iteration method
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.eachEvaluate = (col, iterator, context) ->
  if _.isFunction col
    col = col()
  _.each.call this, col, iterator, context</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.eachRecursive (list, iterator, context)
    Iterate over a list recursively. If you find a function call it and iterate over that.</p>

<pre><code>list        Array to loop over (recursively)
iterator    Function to call on each step
context     (Optional) Object to pass as 'this' to iteration method
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.eachEvaluateRecursive = (col, iterator, context) -></p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>// _.defaults: Fill in a given object with default properties.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojtag-name-attributes-content-content-">oj.tag (name, attributes, content, content, ...)</h2>

<pre><code>name          String of the tag to serialize
attributes    (Optional) Object defining attributes of tag being serialized
              Keys have smart mappings:
                  'c'  will map to 'class'
                  'fontSize' will map to 'font-size'
                  'borderRadius' will map to 'moz-border-radius', etc.
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>oj._.evaluate (obj)</p>

<pre><code>Map through structure and execute all methods

name          String of the tag to serialize
attributes    (Optional) Object defining attributes of tag being serialized
              Keys have smart mappings:
                  'c'  will map to 'class'
                  'fontSize' will map to 'font-size'
                  'borderRadius' will map to 'moz-border-radius', etc.
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>_.evaluate = (any) ->
  if _.isObject any
    for k, v of any
      if _.isFunction v
        any[k] = v()
  else if _.isArray any
    for v, k in any
      if _.isFunction v</p></div></div><div class="code"><div class="wrapper"><span class="nv">oj.tag = </span><span class="nf">(name, attributes, contents) -&gt;</span>
  <span class="k">throw</span> <span class="s">&#39;oj.tag error: argument 1 is not a string (expected tag name)&#39;</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">name</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>If options isn't an object push it into contents</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">attributes</span>
    <span class="nx">contents</span><span class="p">.</span><span class="nx">unshift</span> <span class="nx">attributes</span>

  <span class="nv">ojml = </span><span class="p">{</span><span class="nv">oj: </span><span class="nx">name</span><span class="p">}</span>










  <span class="nx">ojml</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>children = []
for content in contents
  if <em>isFunction content
    children.push content()
  else if _.isString content or _isNumber content or _isBoolean content or
  children.push content
  {oj: '</em>' + name, contents: contents}</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="ojextend-context">oj.extend (context)</h2>

<pre><code>Extend oj methods into a context. Common contexts are `global` `window`
and `this` (used in coffee script). Helper methods are not extended (oj._)

context          Object to extend oj methods and objects into
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">oj.extend = </span><span class="nf">(context) -&gt;</span>
  <span class="nv">o = </span><span class="p">{}</span>
  <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">oj</span>
    <span class="k">if</span> <span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span>
      <span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
  <span class="k">delete</span> <span class="nx">o</span><span class="p">.</span><span class="nx">extend</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">o</span></div></div></div></div></body></html>